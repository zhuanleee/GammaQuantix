<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamma Quantix - Options Flow & GEX Analysis</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“Š</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://unpkg.com/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="css/styles.css?v=20260208d">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1 class="logo">Gamma Quantix</h1>
            <span class="tagline">Options Flow & GEX Analysis</span>
        </div>
        <div class="header-right">
            <div class="ticker-search">
                <input type="text" id="ticker-input" placeholder="Enter ticker (e.g., SPY, /ES)" autocomplete="off" oninput="var s=document.getElementById('options-ticker-input');if(s)s.value=this.value">
                <button id="analyze-btn" onclick="loadOptionsAnalysis()">Analyze</button>
            </div>
            <div class="market-status" id="market-status" title="US market hours: 9:30 AM - 4:00 PM ET. Green = open, Red = closed.">
                <span class="status-dot"></span>
                <span id="status-text">Loading...</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content-full">
        <!-- TIER 1: Market Sentiment Hero Zone -->
        <div class="hero-zone">
            <div class="options-hero-grid">
                <!-- Left: Visual Sentiment Gauge -->
                <div class="sentiment-gauge-wrapper" title="Overall market sentiment derived from options flow, GEX regime, and P/C ratio">
                    <div class="sentiment-gauge-title">MARKET SENTIMENT</div>
                    <div class="sentiment-gauge-container">
                        <div class="sentiment-gauge-glow" id="sentiment-glow"></div>
                        <svg viewBox="0 0 200 115" class="sentiment-gauge-svg">
                            <defs>
                                <linearGradient id="sentimentGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" stop-color="#ef4444"/>
                                    <stop offset="25%" stop-color="#f97316"/>
                                    <stop offset="50%" stop-color="#eab308"/>
                                    <stop offset="75%" stop-color="#22c55e"/>
                                    <stop offset="100%" stop-color="#10b981"/>
                                </linearGradient>
                                <linearGradient id="sentimentGradientDim" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" stop-color="rgba(239,68,68,0.15)"/>
                                    <stop offset="50%" stop-color="rgba(234,179,8,0.15)"/>
                                    <stop offset="100%" stop-color="rgba(16,185,129,0.15)"/>
                                </linearGradient>
                                <filter id="arcGlow">
                                    <feGaussianBlur stdDeviation="3" result="blur"/>
                                    <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                                </filter>
                                <filter id="needleShadow">
                                    <feDropShadow dx="0" dy="0" stdDeviation="2" flood-color="rgba(255,255,255,0.4)"/>
                                </filter>
                            </defs>
                            <!-- Background track -->
                            <path d="M 20 95 A 80 80 0 0 1 180 95" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="14" stroke-linecap="round"/>
                            <!-- Glowing arc -->
                            <path d="M 20 95 A 80 80 0 0 1 180 95" fill="none" stroke="url(#sentimentGradient)" stroke-width="10" stroke-linecap="round" filter="url(#arcGlow)"/>
                            <!-- Tick marks -->
                            <line x1="24" y1="82" x2="28" y2="86" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
                            <line x1="52" y1="47" x2="55" y2="51" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
                            <line x1="100" y1="18" x2="100" y2="23" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
                            <line x1="148" y1="47" x2="145" y2="51" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
                            <line x1="176" y1="82" x2="172" y2="86" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
                            <!-- Needle -->
                            <g id="sentiment-needle" transform="rotate(0, 100, 95)" filter="url(#needleShadow)">
                                <line x1="100" y1="95" x2="100" y2="30" stroke="white" stroke-width="2.5" stroke-linecap="round" opacity="0.9"/>
                                <circle cx="100" cy="95" r="5" fill="white" opacity="0.95"/>
                                <circle cx="100" cy="95" r="2.5" fill="var(--bg-elevated)"/>
                            </g>
                            <!-- Labels along arc -->
                            <text x="18" y="112" fill="var(--text-dim)" font-size="8" text-anchor="start" font-family="Inter, sans-serif">Bearish</text>
                            <text x="100" y="112" fill="var(--text-dim)" font-size="8" text-anchor="middle" font-family="Inter, sans-serif">Neutral</text>
                            <text x="182" y="112" fill="var(--text-dim)" font-size="8" text-anchor="end" font-family="Inter, sans-serif">Bullish</text>
                        </svg>
                    </div>
                    <div class="sentiment-label" id="sentiment-label">--</div>
                    <div class="sentiment-description" id="sentiment-description">Loading...</div>
                </div>

                <!-- Right: Key Metrics Grid -->
                <div>
                    <div class="options-metrics-grid">
                        <div class="metric-card" title="CBOE Volatility Index - measures expected 30-day S&P 500 volatility. Below 15 = low fear, 15-25 = normal, above 25 = elevated fear.">
                            <div class="metric-label">VIX</div>
                            <div class="metric-value" id="vix-level">--</div>
                            <div class="metric-sub" id="vix-label">--</div>
                        </div>
                        <div class="metric-card" title="Put/Call Ratio - total put OI divided by call OI. Below 0.7 = bullish, 0.7-1.0 = neutral, above 1.0 = bearish/hedging heavy.">
                            <div class="metric-label">P/C RATIO</div>
                            <div class="metric-value" id="spy-pc-ratio">--</div>
                            <div class="metric-sub" id="spy-pc-label">--</div>
                        </div>
                        <div class="metric-card" style="border: 1px solid var(--purple);" title="Max Pain - the strike price where option holders (buyers) lose the most money. Price tends to gravitate toward this level near expiration.">
                            <div class="metric-label" style="color: var(--purple);">MAX PAIN</div>
                            <div class="metric-value" id="spy-max-pain" style="color: var(--purple);">--</div>
                            <div class="metric-sub" id="spy-max-pain-dist">--</div>
                        </div>
                        <div class="metric-card" title="Gamma Exposure (GEX) - net dealer gamma. Positive GEX = dealers sell rallies/buy dips (stabilizing). Negative GEX = dealers amplify moves (volatile).">
                            <div class="metric-label">GEX</div>
                            <div class="metric-value" id="market-gex">--</div>
                            <div class="metric-sub" id="gex-label">--</div>
                        </div>
                    </div>
                    <!-- Expiry selector -->
                    <div class="expiry-bar">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 0.7rem; color: var(--text-muted);">SPY Expiry:</span>
                            <select id="market-sentiment-expiry" onchange="loadMarketSentimentForExpiry()">
                                <option value="">Loading...</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 0.65rem; color: var(--text-muted);" id="spy-call-put-oi">--</span>
                            <button class="btn btn-ghost" onclick="loadMarketSentiment()" style="font-size: 0.7rem; padding: 4px 10px;">Refresh</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Ticker Shortcuts -->
        <div class="quick-tickers">
            <span style="font-size: 0.75rem; color: var(--text-muted); padding: 6px 0;">Equities:</span>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('SPY')" title="SPDR S&P 500 ETF">SPY</button>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('QQQ')" title="Invesco Nasdaq 100 ETF">QQQ</button>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('NVDA')" title="NVIDIA Corporation">NVDA</button>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('TSLA')" title="Tesla Inc">TSLA</button>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('AAPL')" title="Apple Inc">AAPL</button>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('AMD')" title="Advanced Micro Devices">AMD</button>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('META')" title="Meta Platforms">META</button>
            <span class="ticker-divider"></span>
            <span style="font-size: 0.75rem; color: var(--orange); padding: 6px 0;">Futures:</span>
            <button class="btn btn-ghost ticker-btn futures-btn" onclick="quickAnalyzeTicker('/ES')" title="E-mini S&P 500">/ES</button>
            <button class="btn btn-ghost ticker-btn futures-btn" onclick="quickAnalyzeTicker('/NQ')" title="E-mini Nasdaq">/NQ</button>
            <button class="btn btn-ghost ticker-btn futures-btn" onclick="quickAnalyzeTicker('/CL')" title="Crude Oil">/CL</button>
            <button class="btn btn-ghost ticker-btn futures-btn" onclick="quickAnalyzeTicker('/GC')" title="Gold">/GC</button>
        </div>

        <!-- Search & Action Bar -->
        <div class="filter-bar" style="margin-bottom: 16px; flex-wrap: wrap;">
            <input type="text" id="options-ticker-input" placeholder="Enter ticker..."
                style="flex: 1; min-width: 120px; max-width: 180px; padding: 8px 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 0.875rem;"
                oninput="document.getElementById('ticker-input').value=this.value"
                onkeypress="if(event.key==='Enter') loadOptionsAnalysis()" />
            <button class="btn btn-primary" onclick="loadOptionsAnalysis()" style="padding: 8px 16px;">Analyze</button>
            <button class="btn btn-ghost" onclick="loadSmartMoneyFlow()" style="padding: 8px 12px;" title="Analyze institutional and smart money options flow patterns">Smart Flow</button>
            <button class="btn btn-ghost" onclick="loadWhaleTrades()" style="padding: 8px 12px;" title="Large options trades over $50K - likely institutional activity">Whale Trades</button>
            <button class="btn btn-ghost" onclick="loadUnusualActivity()" style="padding: 8px 12px;" title="Options with abnormally high volume relative to open interest">Unusual Activity</button>
        </div>

        <!-- Tab Bar -->
        <div class="tab-bar">
            <button class="tab-btn" data-tab="tab-chart" onclick="showTab('tab-chart')" title="Full-screen price chart with technical indicators, GEX overlays, and volume">
                Chart
                <span class="tab-accent"></span>
            </button>
            <button class="tab-btn active" data-tab="tab-analysis" onclick="showTab('tab-analysis')" title="Options sentiment, max pain, IV rank, expected move, and IV smile">
                Analysis
                <span class="tab-accent"></span>
            </button>
            <button class="tab-btn" data-tab="tab-chain-flow" onclick="showTab('tab-chain-flow')" title="Full options chain with greeks, whale trades, and unusual activity scanner">
                Chain & Flow
                <span class="tab-accent"></span>
            </button>
            <button class="tab-btn" data-tab="tab-gex" onclick="showTab('tab-gex')" title="GEX dashboard with regime analysis, key levels, and strike data">
                GEX
                <span class="tab-accent"></span>
            </button>
            <button class="tab-btn" data-tab="tab-strategy" onclick="showTab('tab-strategy')" title="Market X-Ray analysis and strategy recommendations">
                Strategy
                <span class="tab-accent"></span>
            </button>
            <button class="tab-btn" data-tab="tab-backtest" onclick="showTab('tab-backtest')" title="Scan MAG 7 + SPY/QQQ for highest-probability trade setup">
                Scanner
                <span class="tab-accent"></span>
            </button>
        </div>

        <!-- ===== TAB: ANALYSIS ===== -->
        <div class="tab-content active" id="tab-analysis">

            <!-- Options Analysis Container -->
            <div id="options-analysis-container" class="card" style="display: none; margin-bottom: 20px; border-left: 3px solid var(--blue);">
                <div class="card-header">
                    <div class="card-title">Options Analysis <span id="oa-ticker" style="color: var(--blue); margin-left: 8px;"></span></div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <select id="oa-expiry-select" onchange="loadOptionsForExpiry()">
                            <option value="">Select expiration...</option>
                        </select>
                        <div class="dte-buttons">
                            <button class="btn btn-ghost" onclick="selectExpiryByDays(0)" title="0DTE">0D</button>
                            <button class="btn btn-ghost" onclick="selectExpiryByDays(7)" title="~1 Week">1W</button>
                            <button class="btn btn-ghost" onclick="selectExpiryByDays(30)" title="~1 Month">1M</button>
                            <button class="btn btn-ghost" onclick="selectExpiryByDays(90)" title="~3 Months">3M</button>
                        </div>
                        <div id="oa-sentiment" class="sentiment-badge">--</div>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Main Metrics Row -->
                    <div class="metrics-grid-5">
                        <div class="metric-box" title="Put/Call Ratio for this expiration. Below 0.7 = bullish, 0.7-1.0 = neutral, above 1.0 = bearish.">
                            <div class="metric-label">P/C RATIO</div>
                            <div class="metric-value" id="oa-pc-ratio">--</div>
                            <div class="metric-sub" id="oa-pc-label">--</div>
                        </div>
                        <div class="metric-box" id="oa-gex-card" style="cursor: pointer; border: 2px solid transparent;" onclick="showOptionsChart('gex')" title="Gamma Exposure - click to view GEX by strike chart. Positive = dealers stabilize price, Negative = dealers amplify moves.">
                            <div class="metric-label">GEX <span class="info-icon" data-tooltip="Gamma Exposure: Positive GEX = stabilizing. Negative GEX = volatile.">i</span></div>
                            <div class="metric-value" id="oa-gex">--</div>
                            <div class="metric-sub" id="oa-gex-label">--</div>
                        </div>
                        <div class="metric-box" title="IV Rank - where current implied volatility sits vs its 52-week range. High (>50%) = IV is expensive, favor selling. Low (<30%) = IV is cheap, favor buying.">
                            <div class="metric-label">IV RANK <span class="info-icon" data-tooltip="Where current IV sits vs past year. High = sell, Low = buy.">i</span></div>
                            <div class="metric-value" id="oa-iv-rank">--</div>
                            <div class="metric-sub" id="oa-iv-label">--</div>
                        </div>
                        <div class="metric-box" id="oa-maxpain-card" style="cursor: pointer; border: 2px solid var(--purple);" onclick="showOptionsChart('maxpain')" title="Max Pain - click to view pain chart. The strike where option writers lose the least. Price tends to pin here at expiration.">
                            <div class="metric-label">MAX PAIN <span class="info-icon" data-tooltip="Strike where option writers lose the least. Stocks gravitate here near expiry.">i</span></div>
                            <div class="metric-value" id="oa-max-pain" style="color: var(--purple);">--</div>
                            <div class="metric-sub" id="oa-mp-distance">--</div>
                        </div>
                        <div class="metric-box" title="Current price of the underlying asset, updated in real-time via WebSocket streaming.">
                            <div class="metric-label">CURRENT</div>
                            <div class="metric-value" id="oa-current-price">--</div>
                            <div class="metric-sub" id="oa-dte">--</div>
                        </div>
                    </div>
                    <!-- OI Stats Row -->
                    <div class="oi-stats-row">
                        <div title="Total open interest on call options for this expiration"><span class="stat-label">Call OI:</span> <span class="stat-value green" id="oa-call-oi">--</span></div>
                        <div class="divider"></div>
                        <div title="Total open interest on put options for this expiration"><span class="stat-label">Put OI:</span> <span class="stat-value red" id="oa-put-oi">--</span></div>
                        <div class="divider"></div>
                        <div><span class="stat-label">Expiry:</span> <span class="stat-value" id="oa-expiry-display">--</span></div>
                    </div>
                    <!-- Options Chart (Max Pain / GEX toggle) -->
                    <div id="oa-chart-container" style="margin-top: 16px;">
                        <div id="oa-chart-title" style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 8px;">Pain by Strike Price</div>
                        <div id="oa-chart" style="background: var(--bg-hover); border-radius: 8px; padding: 16px; min-height: 160px;">
                            <div style="color: var(--text-muted); font-size: 0.8rem; text-align: center; padding: 40px;">
                                Enter a ticker and click Analyze to see options data
                            </div>
                        </div>
                        <div id="oa-chart-legend" style="display: flex; justify-content: center; gap: 20px; margin-top: 8px; font-size: 0.7rem;">
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div style="width: 12px; height: 12px; background: var(--purple); border-radius: 2px;"></div>
                                <span style="color: var(--text-muted);">Max Pain Strike</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div style="width: 12px; height: 2px; background: var(--blue);"></div>
                                <span style="color: var(--text-muted);">Current Price</span>
                            </div>
                        </div>
                    </div>

                    <!-- Interpretation -->
                    <div class="interpretation-box" id="oa-interpretation" style="margin-top: 12px;">
                        Enter a ticker and click Analyze to see options sentiment and max pain analysis.
                    </div>
                </div>
            </div>

            <!-- Expected Move Card -->
            <div class="em-card" id="expected-move-card" style="display: none;" title="Expected Move - the range the market is pricing in based on implied volatility. 1 SD = 68% probability, 1.5 SD = 87%, 2 SD = 95%.">
                <div class="em-card-header">
                    <div class="em-card-title">EXPECTED MOVE</div>
                    <div class="em-dte-badge" id="em-dte-badge" title="Days to expiration for this expected move calculation">-- DTE</div>
                </div>
                <div class="em-levels-row">
                    <div>
                        <span style="color: var(--red); font-weight: 600;" id="em-sd2-lower">--</span>
                        <span style="color: var(--text-muted); font-size: 0.7rem; margin-left: 4px;" title="95% chance price stays above this level">-2 SD</span>
                    </div>
                    <div>
                        <span style="color: var(--orange); font-weight: 600;" id="em-sd1-lower">--</span>
                        <span style="color: var(--text-muted); font-size: 0.7rem; margin-left: 4px;" title="68% chance price stays above this level">-1 SD</span>
                    </div>
                    <div style="text-align: center;">
                        <span style="color: var(--text); font-weight: 700; font-size: 1rem;" id="em-current">--</span>
                    </div>
                    <div>
                        <span style="color: var(--text-muted); font-size: 0.7rem; margin-right: 4px;" title="68% chance price stays below this level">+1 SD</span>
                        <span style="color: var(--orange); font-weight: 600;" id="em-sd1-upper">--</span>
                    </div>
                    <div>
                        <span style="color: var(--text-muted); font-size: 0.7rem; margin-right: 4px;" title="95% chance price stays below this level">+2 SD</span>
                        <span style="color: var(--red); font-weight: 600;" id="em-sd2-upper">--</span>
                    </div>
                </div>
                <div class="em-range-container" id="em-range-container">
                    <!-- Bars filled by JS -->
                </div>
                <div class="em-legend">
                    <div class="em-legend-item">
                        <div class="em-legend-dot" style="background: rgba(34, 197, 94, 0.4);"></div>
                        <span>68% (1 SD)</span>
                    </div>
                    <div class="em-legend-item">
                        <div class="em-legend-dot" style="background: rgba(249, 115, 22, 0.35);"></div>
                        <span>87% (1.5 SD)</span>
                    </div>
                    <div class="em-legend-item">
                        <div class="em-legend-dot" style="background: rgba(239, 68, 68, 0.25);"></div>
                        <span>95% (2 SD)</span>
                    </div>
                </div>
            </div>

            <!-- IV Smile / Skew Chart -->
            <div class="iv-smile-container" id="iv-smile-container" style="display: none;">
                <div class="iv-smile-header" title="Implied Volatility Smile - shows how IV varies by strike price. Steep left skew = fear of downside. Flat = balanced expectations.">IV SMILE / SKEW</div>
                <div id="iv-smile-chart"></div>
            </div>

        </div><!-- end tab-analysis -->

        <!-- ===== TAB: CHAIN & FLOW ===== -->
        <div class="tab-content" id="tab-chain-flow">

            <!-- Ticker Summary Stats -->
            <div class="stats-bar" id="options-summary" style="display: none; margin-bottom: 20px;">
                <div class="stat-item">
                    <span class="stat-label">Sentiment</span>
                    <span class="stat-value" id="opt-sentiment">--</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">P/C Ratio</span>
                    <span class="stat-value" id="opt-pc-ratio">--</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Call Volume</span>
                    <span class="stat-value green" id="opt-call-vol">--</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Put Volume</span>
                    <span class="stat-value red" id="opt-put-vol">--</span>
                </div>
            </div>

            <!-- Options Chain Tables -->
            <div class="grid-2" id="options-tables" style="display: none; margin-bottom: 20px;">
                <!-- Calls Table -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title" style="color: var(--green);">Calls</div>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <div style="max-height: 500px; overflow-y: auto;">
                            <table class="options-chain-table">
                                <thead>
                                    <tr>
                                        <th style="width: 70px;" title="Option strike price">Strike</th>
                                        <th style="width: 60px;" title="Best bid price - what buyers are willing to pay">Bid</th>
                                        <th style="width: 60px;" title="Best ask price - what sellers are asking">Ask</th>
                                        <th style="width: 60px;" title="Today's trading volume for this contract">Vol</th>
                                        <th style="width: 70px;" title="Open Interest - total outstanding contracts">OI</th>
                                        <th style="width: 50px;" title="Implied Volatility - market's expected annualized volatility">IV</th>
                                        <th style="width: 50px;" title="Delta - probability of finishing in-the-money (approx)">Delta</th>
                                    </tr>
                                </thead>
                                <tbody id="calls-table-body">
                                    <tr><td colspan="7" style="text-align: center; padding: 40px; color: var(--text-muted);">Analyze a ticker to view chain</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- Puts Table -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title" style="color: var(--red);">Puts</div>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <div style="max-height: 500px; overflow-y: auto;">
                            <table class="options-chain-table">
                                <thead>
                                    <tr>
                                        <th style="width: 70px;" title="Option strike price">Strike</th>
                                        <th style="width: 60px;" title="Best bid price - what buyers are willing to pay">Bid</th>
                                        <th style="width: 60px;" title="Best ask price - what sellers are asking">Ask</th>
                                        <th style="width: 60px;" title="Today's trading volume for this contract">Vol</th>
                                        <th style="width: 70px;" title="Open Interest - total outstanding contracts">OI</th>
                                        <th style="width: 50px;" title="Implied Volatility - market's expected annualized volatility">IV</th>
                                        <th style="width: 50px;" title="Delta - probability of finishing in-the-money (approx)">Delta</th>
                                    </tr>
                                </thead>
                                <tbody id="puts-table-body">
                                    <tr><td colspan="7" style="text-align: center; padding: 40px; color: var(--text-muted);">Analyze a ticker to view chain</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Whale Trades + Unusual Activity -->
            <div class="grid-2" style="margin-bottom: 20px;">
                <div class="card">
                    <div class="card-header">
                        <span title="Large options trades exceeding $50K in premium - often institutional or smart money activity">Whale Trades (>$50K)</span>
                        <button class="btn btn-ghost" onclick="loadWhaleTrades()">Refresh</button>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <div id="whale-trades-container" style="max-height: 300px; overflow-y: auto;">
                            <div style="padding: 20px; text-align: center; color: var(--text-muted); font-size: 0.8rem;">
                                Click Refresh to load whale trades
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <span title="Options with volume significantly exceeding open interest, signaling new positioning">Unusual Activity</span>
                        <button class="btn btn-ghost" onclick="loadUnusualActivity()">Refresh</button>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <div id="unusual-activity-container" style="max-height: 300px; overflow-y: auto;">
                            <div style="padding: 20px; text-align: center; color: var(--text-muted); font-size: 0.8rem;">
                                Click Refresh to scan unusual activity
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Smart Money Flow -->
            <div class="card" style="margin-bottom: 20px;">
                <div class="card-header">
                    <span>Smart Money Flow Analysis</span>
                </div>
                <div class="card-body">
                    <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                        <input type="text" id="flow-ticker-input" placeholder="Enter ticker (e.g., NVDA)" style="flex: 1; background: var(--bg-hover); border: 1px solid var(--border); color: var(--text); padding: 10px; border-radius: 6px; font-size: 0.85rem;" onkeypress="if(event.key==='Enter') loadSmartMoneyFlow()" />
                        <button class="btn btn-primary" onclick="loadSmartMoneyFlow()" style="padding: 10px 20px;">Analyze</button>
                    </div>
                    <div id="smart-money-flow-container">
                        <div style="text-align: center; color: var(--text-muted); font-size: 0.8rem; padding: 20px;">
                            Enter a ticker to analyze institutional and smart money options flow
                        </div>
                    </div>
                </div>
            </div>

        </div><!-- end tab-chain-flow -->

        <!-- ===== TAB: CHART ===== -->
        <div class="tab-content" id="tab-chart">
            <div id="options-viz-container" class="card" style="display: none;">
                <div class="card-header">
                    <div class="card-title">CHART <span id="viz-ticker-label"></span> <span id="live-status" style="font-size: 0.65rem; font-weight: 500; margin-left: 8px; display: none;"><span id="live-status-dot" style="display: inline-block; width: 7px; height: 7px; border-radius: 50%; margin-right: 3px; vertical-align: middle;"></span><span id="live-status-text"></span></span></div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <div class="interval-selector">
                            <button class="interval-btn" onclick="setInterval_('1m')">1m</button>
                            <button class="interval-btn" onclick="setInterval_('5m')">5m</button>
                            <button class="interval-btn" onclick="setInterval_('15m')">15m</button>
                            <button class="interval-btn" onclick="setInterval_('1h')">1h</button>
                            <button class="interval-btn" onclick="setInterval_('4h')">4h</button>
                            <button class="interval-btn active" onclick="setInterval_('1d')">1D</button>
                            <button class="interval-btn" onclick="setInterval_('1w')">1W</button>
                        </div>
                        <select id="viz-timeframe" onchange="refreshOptionsViz()" title="Chart timeframe - select how far back to show price history">
                            <option value="1825" selected>5Y</option>
                            <option value="7300">All</option>
                        </select>
                        <button class="btn btn-ghost" onclick="refreshOptionsViz()" title="Refresh">Refresh</button>
                        <button class="btn btn-ghost fullscreen-btn" onclick="toggleChartFullscreen()" title="Toggle fullscreen">&#x26F6;</button>
                    </div>
                </div>
                <!-- Toggle Panel -->
                <div class="toggle-panel">
                    <label class="toggle-item" title="Call Wall - strike with highest call gamma. Acts as resistance; price tends to slow or reverse here.">
                        <input type="checkbox" id="viz-toggle-callwall" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label call">Call Wall</span>
                    </label>
                    <label class="toggle-item" title="Put Wall - strike with highest put gamma. Acts as support; dealers buy dips here.">
                        <input type="checkbox" id="viz-toggle-putwall" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label put">Put Wall</span>
                    </label>
                    <label class="toggle-item" title="Gamma Flip - strike where net GEX crosses from positive to negative. Above = stabilizing, below = volatile.">
                        <input type="checkbox" id="viz-toggle-gammaflip" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label gamma">Gamma Flip</span>
                    </label>
                    <label class="toggle-item" title="Max Pain - strike where option holders lose the most. Price gravitates here near expiry.">
                        <input type="checkbox" id="viz-toggle-maxpain" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label maxpain">Max Pain</span>
                    </label>
                    <span class="toggle-divider">|</span>
                    <label class="toggle-item" title="Value Area Low - bottom of the 70% volume zone. Acts as support.">
                        <input type="checkbox" id="viz-toggle-val" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label val">VAL</span>
                    </label>
                    <label class="toggle-item" title="Point of Control - price level with the highest traded volume. Strongest magnet level.">
                        <input type="checkbox" id="viz-toggle-poc" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label poc">POC</span>
                    </label>
                    <label class="toggle-item" title="Value Area High - top of the 70% volume zone. Acts as resistance.">
                        <input type="checkbox" id="viz-toggle-vah" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label vah">VAH</span>
                    </label>
                    <span class="toggle-divider">|</span>
                    <label class="toggle-item" title="Toggle the GEX by strike bar chart below the price chart.">
                        <input type="checkbox" id="viz-toggle-gex" checked onchange="toggleGexChart()">
                        <span class="toggle-label">GEX Chart</span>
                    </label>
                </div>
                <!-- Indicator Toggle Panel -->
                <div class="toggle-panel-indicators">
                    <label class="toggle-item" title="Simple Moving Average (20 period) - short-term trend">
                        <input type="checkbox" id="viz-toggle-sma20" onchange="updateIndicators()">
                        <span class="toggle-label sma20">SMA 20</span>
                    </label>
                    <label class="toggle-item" title="Simple Moving Average (50 period) - medium-term trend">
                        <input type="checkbox" id="viz-toggle-sma50" onchange="updateIndicators()">
                        <span class="toggle-label sma50">SMA 50</span>
                    </label>
                    <label class="toggle-item" title="Simple Moving Average (200 period) - long-term trend">
                        <input type="checkbox" id="viz-toggle-sma200" onchange="updateIndicators()">
                        <span class="toggle-label sma200">SMA 200</span>
                    </label>
                    <label class="toggle-item" title="Volume Weighted Average Price - institutional fair value">
                        <input type="checkbox" id="viz-toggle-vwap" onchange="updateIndicators()">
                        <span class="toggle-label vwap">VWAP</span>
                    </label>
                    <label class="toggle-item" title="Bollinger Bands (20, 2) - volatility envelope around SMA 20">
                        <input type="checkbox" id="viz-toggle-bb" onchange="updateIndicators()">
                        <span class="toggle-label bb">BB</span>
                    </label>
                    <span class="toggle-divider">|</span>
                    <label class="toggle-item" title="Relative Strength Index (14) - momentum oscillator 0-100">
                        <input type="checkbox" id="viz-toggle-rsi" onchange="toggleRsiChart()">
                        <span class="toggle-label rsi">RSI</span>
                    </label>
                    <label class="toggle-item" title="Relative Strength vs SPY - compares stock performance against S&P 500">
                        <input type="checkbox" id="viz-toggle-rs" onchange="toggleRsChart()">
                        <span class="toggle-label rs">RS</span>
                    </label>
                    <label class="toggle-item" title="Volume bars at bottom of price chart">
                        <input type="checkbox" id="viz-toggle-volume" checked onchange="toggleVolumeSeries()">
                        <span class="toggle-label vol">Vol</span>
                    </label>
                </div>
                <!-- Fullscreen-only ticker bar -->
                <div class="fs-ticker-bar">
                    <input type="text" id="fs-ticker-input" placeholder="Ticker..." onkeypress="if(event.key==='Enter'){quickAnalyzeTicker(this.value.toUpperCase().trim());this.blur();}">
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('SPY')">SPY</button>
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('QQQ')">QQQ</button>
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('NVDA')">NVDA</button>
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('TSLA')">TSLA</button>
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('AAPL')">AAPL</button>
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('AMD')">AMD</button>
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('META')">META</button>
                    <span style="color:var(--border);">|</span>
                    <button class="fs-tk-btn futures" onclick="quickAnalyzeTicker('/ES')">/ES</button>
                    <button class="fs-tk-btn futures" onclick="quickAnalyzeTicker('/NQ')">/NQ</button>
                    <button class="fs-tk-btn futures" onclick="quickAnalyzeTicker('/CL')">/CL</button>
                    <button class="fs-tk-btn futures" onclick="quickAnalyzeTicker('/GC')">/GC</button>
                </div>
                <div class="card-body chart-body" style="min-height: 600px;">
                    <div id="price-chart-container" class="chart-container" style="min-height: 500px;">
                        <div class="chart-loading">Loading price data...</div>
                    </div>
                    <div id="rsi-chart-container" class="chart-container rsi-pane" style="display:none;">
                    </div>
                    <div id="rs-chart-container" class="chart-container rs-pane" style="display:none;">
                    </div>
                    <div id="gex-chart-container" class="chart-container" style="height: 200px;">
                        <div class="chart-loading">Loading GEX data...</div>
                    </div>
                </div>
                <!-- Info Bar -->
                <div class="info-bar">
                    <div class="info-item" title="Live streaming price via Tastytrade WebSocket">
                        <span class="info-label">Current Price</span>
                        <span class="info-value" id="viz-current-price">--</span>
                    </div>
                    <div class="info-item" title="Call Wall - highest call gamma strike, acts as resistance">
                        <span class="info-label">Call Wall</span>
                        <span class="info-value call" id="viz-call-wall">--</span>
                    </div>
                    <div class="info-item" title="Put Wall - highest put gamma strike, acts as support">
                        <span class="info-label">Put Wall</span>
                        <span class="info-value put" id="viz-put-wall">--</span>
                    </div>
                    <div class="info-item" title="Max Pain - strike where option holders lose the most at expiry">
                        <span class="info-label">Max Pain</span>
                        <span class="info-value maxpain" id="viz-max-pain">--</span>
                    </div>
                    <div class="info-item" title="Total net Gamma Exposure across all strikes. Positive = stabilizing, Negative = volatile.">
                        <span class="info-label">Total GEX</span>
                        <span class="info-value" id="viz-total-gex">--</span>
                    </div>
                </div>
            </div>
        </div><!-- end tab-chart -->

        <!-- ===== TAB: GEX ===== -->
        <div class="tab-content" id="tab-gex">

            <!-- GEX Dashboard -->
            <div id="gex-dashboard-container" class="card" style="display: none; margin-bottom: 20px; border-left: 3px solid var(--orange);">
                <div class="card-header">
                    <div class="card-title">GEX Dashboard <span id="gex-ticker" style="color: var(--orange); margin-left: 8px;"></span></div>
                    <button class="btn btn-primary" onclick="loadGexDashboard()">Refresh GEX</button>
                </div>
                <div class="card-body">
                    <!-- Regime Row -->
                    <div class="regime-grid">
                        <!-- Volatility Regime -->
                        <div class="regime-box" title="GEX-based volatility regime. Positive Gamma = low vol (sell premium). Negative Gamma = high vol (buy protection). Transition = mixed signals.">
                            <div class="regime-header">VOLATILITY REGIME</div>
                            <div class="regime-content">
                                <div id="gex-regime-badge" class="regime-badge">--</div>
                                <div class="regime-stats">
                                    <div><span class="stat-label">Confidence:</span> <span id="gex-regime-confidence">--</span></div>
                                    <div><span class="stat-label">Strategy:</span> <span id="gex-regime-strategy">--</span></div>
                                </div>
                            </div>
                            <div class="regime-rec" id="gex-regime-recommendation">--</div>
                        </div>
                        <!-- Combined Regime -->
                        <div class="regime-box" title="Combined regime using both GEX and Put/Call ratio Z-score. Provides risk level and position sizing guidance.">
                            <div class="regime-header">COMBINED REGIME (GEX + P/C)</div>
                            <div class="regime-content">
                                <div id="combined-regime-badge" class="regime-badge">--</div>
                                <div class="regime-stats">
                                    <div><span class="stat-label">Risk Level:</span> <span id="combined-risk-level">--</span></div>
                                    <div><span class="stat-label">Position Size:</span> <span id="combined-position-size">--</span></div>
                                </div>
                            </div>
                            <div class="regime-rec" id="combined-recommendation">--</div>
                        </div>
                    </div>
                    <!-- Key Levels Row -->
                    <div class="levels-grid">
                        <div class="level-box call-border" title="Strike with the highest call gamma exposure. Dealers are short calls here, so they sell as price rises - creating resistance.">
                            <div class="level-header">CALL WALL (RESIST)</div>
                            <div class="level-value call" id="gex-call-wall">--</div>
                            <div class="level-sub" id="gex-call-wall-dist">--</div>
                        </div>
                        <div class="level-box put-border" title="Strike with the highest put gamma exposure. Dealers are short puts here, so they buy as price falls - creating support.">
                            <div class="level-header">PUT WALL (SUPPORT)</div>
                            <div class="level-value put" id="gex-put-wall">--</div>
                            <div class="level-sub" id="gex-put-wall-dist">--</div>
                        </div>
                        <div class="level-box gamma-border" title="The strike where net gamma crosses zero. Above this level dealers stabilize price; below it they amplify moves.">
                            <div class="level-header">GAMMA FLIP</div>
                            <div class="level-value gamma" id="gex-gamma-flip">--</div>
                            <div class="level-sub" id="gex-gamma-flip-note">Sign change zone</div>
                        </div>
                        <div class="level-box purple-border" title="Z-score of current P/C ratio vs recent history. Above +1 = extreme bearish positioning, below -1 = extreme bullish.">
                            <div class="level-header">P/C RATIO Z-SCORE</div>
                            <div class="level-value" id="gex-pc-zscore">--</div>
                            <div class="level-sub" id="gex-pc-sentiment">--</div>
                        </div>
                    </div>
                    <!-- GEX Price Ladder -->
                    <div id="gex-price-ladder-container"></div>
                    <!-- Zones & Signals -->
                    <div class="zones-grid">
                        <div class="zone-box">
                            <div class="zone-header blue">Key Zones</div>
                            <div class="zone-content">
                                <div title="Strikes with high positive GEX that attract price - dealers push price toward these levels"><span class="stat-label">Magnet Zones:</span> <span id="gex-magnet-zones">--</span></div>
                                <div title="Strikes with negative GEX where price accelerates - dealers amplify moves past these levels"><span class="stat-label">Acceleration Zones:</span> <span id="gex-accel-zones">--</span></div>
                            </div>
                        </div>
                        <div class="zone-box">
                            <div class="zone-header purple">Trading Signal</div>
                            <div class="zone-content">
                                <div id="gex-signal-badge" class="signal-badge">--</div>
                                <div id="gex-signal-note" class="signal-note">--</div>
                            </div>
                        </div>
                    </div>
                    <!-- Interpretation -->
                    <div class="interpretation-box orange" id="gex-interpretation">
                        Load a ticker to see comprehensive GEX analysis with regime classification, support/resistance levels, and trading signals.
                    </div>
                    <!-- Key Levels Table (Collapsible) -->
                    <div id="gex-levels-table-container" style="display: none; margin-top: 12px;">
                        <div id="gex-levels-table-header" onclick="toggleGexLevelsTable()" class="table-toggle-header">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span id="gex-levels-toggle-icon" class="toggle-icon">&#9654;</span>
                                <span style="font-size: 0.7rem; font-weight: 600; color: var(--text-muted);">DETAILED KEY LEVELS</span>
                                <span id="gex-levels-count" class="levels-count">0 levels</span>
                            </div>
                            <span style="font-size: 0.65rem; color: var(--text-muted);">Click to expand</span>
                        </div>
                        <div id="gex-levels-table-body" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- GEX by Strike Table -->
            <div class="card" style="margin-bottom: 20px;">
                <div class="card-header">
                    <span>GEX by Strike</span>
                    <span class="level-count" id="gex-strike-count">-- levels</span>
                </div>
                <div class="card-body table-body" id="gex-table-container">
                    <table class="gex-table">
                        <thead>
                            <tr>
                                <th title="Option strike price">Strike</th>
                                <th title="Gamma exposure from call options at this strike">Call GEX</th>
                                <th title="Gamma exposure from put options at this strike">Put GEX</th>
                                <th title="Net gamma exposure (Call GEX - Put GEX). Positive = stabilizing, Negative = amplifying.">Net GEX</th>
                                <th title="Total call open interest at this strike">Call OI</th>
                                <th title="Total put open interest at this strike">Put OI</th>
                            </tr>
                        </thead>
                        <tbody id="gex-table-body">
                            <tr><td colspan="6" class="loading">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div><!-- end tab-gex -->

        <!-- ===== TAB: STRATEGY ===== -->
        <div class="tab-content" id="tab-strategy">

            <!-- Active Swing Trades -->
            <div id="swing-trades-container" class="card" style="display: none; margin-bottom: 20px;">
                <div class="card-header">
                    <div class="card-title">Active Trades <span id="swing-trade-count" style="color: var(--blue); margin-left: 8px;">0</span></div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span id="swing-last-refresh" style="font-size: 0.7rem; color: var(--text-muted);"></span>
                        <button class="btn btn-primary" onclick="refreshSwingTrades()" id="swing-refresh-btn">Refresh All</button>
                    </div>
                </div>
                <div class="card-body" id="swing-trades-list">
                    <!-- Trade cards rendered by JS -->
                </div>
            </div>

            <!-- Market X-Ray - Institutional Edge Scanner -->
            <div id="xray-container" class="card" style="margin-bottom: 20px; border-left: 3px solid var(--cyan);">
                <div class="card-header">
                    <div class="card-title">MARKET X-RAY <span id="xray-ticker" style="color: var(--cyan); margin-left: 8px;"></span></div>
                    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                        <select id="xray-expiry-select" style="padding:4px 8px;background:var(--bg);border:1px solid var(--border);border-radius:4px;color:var(--text);font-size:0.75rem;max-width:160px;">
                            <option value="">Auto (nearest)</option>
                        </select>
                        <label class="toggle-item swing-toggle" title="Swing Mode â€” optimizes for 21-45 DTE swing trades">
                            <input type="checkbox" id="xray-swing-mode" onchange="onSwingModeToggle()">
                            <span class="toggle-label" style="color:var(--purple);font-weight:600;font-size:0.72rem;">Swing</span>
                        </label>
                        <div id="xray-composite-badge" style="font-size: 0.8rem; font-weight: 700; padding: 4px 14px; border-radius: 6px; background: var(--bg-hover); color: var(--text-muted);">SCORE: --</div>
                        <button class="btn btn-primary" id="xray-scan-btn" onclick="loadMarketXray()">Scan</button>
                    </div>
                </div>
                <div class="card-body" id="xray-body">
                    <!-- Verdict Banner -->
                    <div id="xray-verdict-banner" class="verdict-banner" style="display: none;">
                        <div class="verdict-text" id="xray-verdict">--</div>
                        <div class="verdict-rec" id="xray-interpretation">Click Scan to analyze market microstructure</div>
                    </div>

                    <!-- Trade Ideas -->
                    <div id="xray-trade-ideas" style="display: none;"></div>

                    <!-- Composite Score Section -->
                    <div class="xray-section" id="xray-sec-composite">
                        <div class="xray-section-header" onclick="toggleXraySection('composite')">
                            <span>Composite Edge Score</span>
                            <span class="xray-toggle" id="xray-toggle-composite">&#9660;</span>
                        </div>
                        <div class="xray-section-body" id="xray-content-composite" style="display: none;"></div>
                    </div>

                    <!-- Dealer Hedging Flow -->
                    <div class="xray-section" id="xray-sec-dealer">
                        <div class="xray-section-header" onclick="toggleXraySection('dealer')">
                            <span>Dealer Hedging Flow Map</span>
                            <span class="xray-toggle" id="xray-toggle-dealer">&#9660;</span>
                        </div>
                        <div class="xray-section-body" id="xray-content-dealer" style="display: none;"></div>
                    </div>

                    <!-- Gamma Squeeze / Pin Risk -->
                    <div class="xray-section" id="xray-sec-squeeze">
                        <div class="xray-section-header" onclick="toggleXraySection('squeeze')">
                            <span>Gamma Squeeze / Pin Risk</span>
                            <span class="xray-toggle" id="xray-toggle-squeeze">&#9660;</span>
                        </div>
                        <div class="xray-section-body" id="xray-content-squeeze" style="display: none;"></div>
                    </div>

                    <!-- Volatility Surface Distortion -->
                    <div class="xray-section" id="xray-sec-volsurface">
                        <div class="xray-section-header" onclick="toggleXraySection('volsurface')">
                            <span>Volatility Surface Distortion</span>
                            <span class="xray-toggle" id="xray-toggle-volsurface">&#9660;</span>
                        </div>
                        <div class="xray-section-body" id="xray-content-volsurface" style="display: none;"></div>
                    </div>

                    <!-- Smart Money Footprint -->
                    <div class="xray-section" id="xray-sec-smartmoney">
                        <div class="xray-section-header" onclick="toggleXraySection('smartmoney')">
                            <span>Smart Money Footprint</span>
                            <span class="xray-toggle" id="xray-toggle-smartmoney">&#9660;</span>
                        </div>
                        <div class="xray-section-body" id="xray-content-smartmoney" style="display: none;"></div>
                    </div>

                    <!-- Optimal Trade Zones -->
                    <div class="xray-section" id="xray-sec-tradezones">
                        <div class="xray-section-header" onclick="toggleXraySection('tradezones')">
                            <span>Optimal Trade Zones</span>
                            <span class="xray-toggle" id="xray-toggle-tradezones">&#9660;</span>
                        </div>
                        <div class="xray-section-body" id="xray-content-tradezones" style="display: none;"></div>
                    </div>

                    <!-- Default message -->
                    <div id="xray-placeholder" style="text-align: center; color: var(--text-muted); font-size: 0.8rem; padding: 20px;">
                        Click Scan to reveal hidden market dynamics beneath the price
                    </div>
                </div>
            </div>

        </div><!-- end tab-strategy -->

        <!-- ===== TAB: BACKTEST (Multi-Ticker Scanner) ===== -->
        <div class="tab-content" id="tab-backtest">
            <div class="card" style="margin-bottom: 20px; border-left: 3px solid var(--magenta);">
                <div class="card-header">
                    <div class="card-title">BEST SETUP SCANNER</div>
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <span id="scanner-status" style="font-size: 0.7rem; color: var(--text-muted);"></span>
                        <span id="scanner-timestamp" style="font-size: 0.65rem; color: var(--text-dim);"></span>
                        <button class="btn btn-primary" id="scanner-scan-btn" onclick="runBestSetupScanner()" style="background: var(--magenta); border-color: var(--magenta);">Scan All</button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="scanner-progress" style="display: none;"></div>
                    <div id="scanner-filter-bar">
                        <button class="scanner-filter-btn active" onclick="setScannerFilter('overall')">Best Overall</button>
                        <button class="scanner-filter-btn" onclick="setScannerFilter('buycalls')">Buy Calls</button>
                        <button class="scanner-filter-btn" onclick="setScannerFilter('buyputs')">Buy Puts</button>
                        <button class="scanner-filter-btn" onclick="setScannerFilter('sellpremium')">Sell Premium</button>
                        <button class="scanner-filter-btn" onclick="setScannerFilter('squeeze')">Highest Squeeze</button>
                        <button class="scanner-filter-btn" onclick="setScannerFilter('momentum')">Momentum</button>
                    </div>
                    <div id="scanner-results"></div>
                    <div id="scanner-placeholder" style="text-align: center; color: var(--text-muted); font-size: 0.8rem; padding: 30px 20px;">
                        Scans X-Ray across <strong>MAG 7 + SPY + QQQ</strong> in parallel to find the highest-probability trade setup.<br>
                        <span style="font-size: 0.7rem; color: var(--text-dim); margin-top: 6px; display: inline-block;">Click <strong>Scan All</strong> to begin.</span>
                    </div>
                </div>
            </div>
            <!-- Drill-down X-Ray detail for selected ticker -->
            <div id="scanner-xray-detail" class="card" style="display: none; margin-bottom: 20px; border-left: 3px solid var(--cyan);"></div>
        </div><!-- end tab-backtest -->
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <span>Gamma Quantix - Options Flow & GEX Analysis</span>
            <span class="footer-divider">|</span>
            <span>Data: Tastytrade, Polygon</span>
            <span class="footer-divider">|</span>
            <span id="last-update">Last update: --</span>
        </div>
    </footer>

    <script src="js/app.js?v=20260208d"></script>
</body>
</html>
