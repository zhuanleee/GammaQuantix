<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamma Quantix - Options Flow & GEX Analysis</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://unpkg.com/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>
    <link rel="stylesheet" href="css/styles.css?v=20260222a">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1 class="logo">Gamma Quantix</h1>
            <span class="tagline">Options Flow & GEX Analysis</span>
        </div>
        <div class="header-right">
            <div class="ticker-search">
                <input type="text" id="ticker-input" placeholder="Enter ticker (e.g., SPY, /ES)" autocomplete="off" oninput="var s=document.getElementById('options-ticker-input');if(s)s.value=this.value">
                <button id="analyze-btn" onclick="loadOptionsAnalysis()">Analyze</button>
            </div>
            <div class="market-status" id="market-status" title="US market hours: 9:30 AM - 4:00 PM ET. Green = open, Red = closed.">
                <span class="status-dot"></span>
                <span id="status-text">Loading...</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content-full">
        <!-- TIER 1: Market Sentiment Hero Zone -->
        <div class="hero-zone">
            <div class="options-hero-grid">
                <!-- ZONE A: Gauge + Confidence Decomposition -->
                <div class="sentiment-gauge-wrapper" title="8-factor institutional sentiment: VIX, VIX T.S., VRP, SKEW, HY Spread, SPX GEX, SPY P/C, Put Skew. Z-score normalized, equal-weighted, I¬≤-based confidence.">
                    <div class="sentiment-gauge-title">MARKET SENTIMENT <span class="sentiment-confidence-badge" id="sentiment-confidence">--% conf</span></div>
                    <div class="sentiment-gauge-container">
                        <div class="sentiment-gauge-glow" id="sentiment-glow"></div>
                        <svg viewBox="0 0 220 125" class="sentiment-gauge-svg">
                            <defs>
                                <linearGradient id="sentimentGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" stop-color="#ef4444"/>
                                    <stop offset="25%" stop-color="#f97316"/>
                                    <stop offset="50%" stop-color="#eab308"/>
                                    <stop offset="75%" stop-color="#22c55e"/>
                                    <stop offset="100%" stop-color="#10b981"/>
                                </linearGradient>
                                <linearGradient id="sentimentGradientDim" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" stop-color="rgba(239,68,68,0.15)"/>
                                    <stop offset="50%" stop-color="rgba(234,179,8,0.15)"/>
                                    <stop offset="100%" stop-color="rgba(16,185,129,0.15)"/>
                                </linearGradient>
                                <filter id="arcGlow">
                                    <feGaussianBlur stdDeviation="3" result="blur"/>
                                    <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
                                </filter>
                                <filter id="needleShadow">
                                    <feDropShadow dx="0" dy="0" stdDeviation="2" flood-color="rgba(255,255,255,0.4)"/>
                                </filter>
                            </defs>
                            <!-- Background track -->
                            <path d="M 22 105 A 88 88 0 0 1 198 105" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="14" stroke-linecap="round"/>
                            <!-- Glowing arc -->
                            <path d="M 22 105 A 88 88 0 0 1 198 105" fill="none" stroke="url(#sentimentGradient)" stroke-width="10" stroke-linecap="round" filter="url(#arcGlow)"/>
                            <!-- Tick marks -->
                            <line x1="26" y1="91" x2="30" y2="95" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
                            <line x1="57" y1="52" x2="60" y2="56" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
                            <line x1="110" y1="20" x2="110" y2="25" stroke="rgba(255,255,255,0.25)" stroke-width="1"/>
                            <line x1="163" y1="52" x2="160" y2="56" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
                            <line x1="194" y1="91" x2="190" y2="95" stroke="rgba(255,255,255,0.2)" stroke-width="1"/>
                            <!-- Needle -->
                            <g id="sentiment-needle" transform="rotate(0, 110, 105)" filter="url(#needleShadow)">
                                <line x1="110" y1="105" x2="110" y2="32" stroke="white" stroke-width="2.5" stroke-linecap="round" opacity="0.9"/>
                                <circle cx="110" cy="105" r="5" fill="white" opacity="0.95"/>
                                <circle cx="110" cy="105" r="2.5" fill="var(--bg-elevated)"/>
                            </g>
                            <!-- Score display -->
                            <text x="110" y="86" text-anchor="middle" fill="white" font-size="22" font-weight="800" font-family="'SF Mono', 'Fira Code', monospace" opacity="0.2" id="sentiment-score-text">--</text>
                            <!-- Labels -->
                            <text x="18" y="122" fill="var(--text-dim)" font-size="8" text-anchor="start" font-family="Inter, sans-serif">Bearish</text>
                            <text x="110" y="122" fill="var(--text-dim)" font-size="8" text-anchor="middle" font-family="Inter, sans-serif">Neutral</text>
                            <text x="202" y="122" fill="var(--text-dim)" font-size="8" text-anchor="end" font-family="Inter, sans-serif">Bullish</text>
                        </svg>
                    </div>
                    <div class="sentiment-label" id="sentiment-label">--</div>
                    <div class="sentiment-description" id="sentiment-description">Loading...</div>
                    <!-- Confidence Decomposition: AGR / STR / DIR micro-bars -->
                    <div class="confidence-decomp" id="confidence-decomp">
                        <div class="conf-bar-row"><span class="conf-bar-label">AGR</span><div class="conf-bar-track"><div class="conf-bar-fill" id="conf-bar-agr"></div></div><span class="conf-bar-val" id="conf-val-agr">--</span></div>
                        <div class="conf-bar-row"><span class="conf-bar-label">STR</span><div class="conf-bar-track"><div class="conf-bar-fill" id="conf-bar-str"></div></div><span class="conf-bar-val" id="conf-val-str">--</span></div>
                        <div class="conf-bar-row"><span class="conf-bar-label">DIR</span><div class="conf-bar-track"><div class="conf-bar-fill" id="conf-bar-dir"></div></div><span class="conf-bar-val" id="conf-val-dir">--</span></div>
                    </div>
                </div>

                <!-- ZONE B + C: Metrics + Factors -->
                <div>
                    <!-- ZONE B: 6 Metric Cards (3x2 grid) -->
                    <div class="options-metrics-grid">
                        <div class="metric-card hero-metric" id="metric-card-vix" title="CBOE Volatility Index - measures expected 30-day S&P 500 volatility. Below 15 = low fear, 15-25 = normal, above 25 = elevated fear.">
                            <div class="metric-label">VIX</div>
                            <div class="metric-value" id="vix-level">--</div><span class="sparkline-container" id="sparkline-vix"></span>
                            <div class="metric-sub" id="vix-label">--</div>
                        </div>
                        <div class="metric-card hero-metric" id="metric-card-pc" title="SPY Put/Call Ratio by OI. Below 0.7 = bullish, 0.7-1.0 = neutral, above 1.0 = bearish.">
                            <div class="metric-label">P/C RATIO</div>
                            <div class="metric-value" id="spy-pc-ratio">--</div><span class="sparkline-container" id="sparkline-pc-ratio"></span>
                            <div class="metric-sub" id="spy-pc-label">--</div>
                        </div>
                        <div class="metric-card hero-metric" id="metric-card-gex" title="SPY Gamma Exposure. Positive = stabilizing (dealers sell rallies/buy dips). Negative = volatile.">
                            <div class="metric-label">SPY GEX</div>
                            <div class="metric-value" id="market-gex">--</div><span class="sparkline-container" id="sparkline-gex"></span>
                            <div class="metric-sub" id="gex-label">--</div>
                        </div>
                        <div class="metric-card hero-metric" id="metric-card-vrp" title="Volatility Risk Premium = VIX - Realized Vol. Positive = implied > realized (normal). Negative = unusual stress.">
                            <div class="metric-label">VRP <span class="zscore-pip" id="zscore-pip-vrp"></span></div>
                            <div class="metric-value" id="vrp-value">--</div>
                            <div class="metric-sub" id="vrp-label">--</div>
                        </div>
                        <div class="metric-card hero-metric" id="metric-card-skew" title="CBOE SKEW Index - measures tail risk premium. Above 145 = elevated crash hedging, below 120 = complacent.">
                            <div class="metric-label">SKEW INDEX <span class="zscore-pip" id="zscore-pip-skew"></span></div>
                            <div class="metric-value" id="skew-value">--</div>
                            <div class="metric-sub" id="skew-label">--</div>
                        </div>
                        <div class="metric-card hero-metric" id="metric-card-hy" title="High Yield OAS Credit Spread (bps). Wide = stress (>450bp), tight = complacent (<350bp).">
                            <div class="metric-label">HY SPREAD <span class="zscore-pip" id="zscore-pip-hy"></span></div>
                            <div class="metric-value" id="hy-value">--</div>
                            <div class="metric-sub" id="hy-label">--</div>
                        </div>
                    </div>
                    <!-- ZONE C: Categorized Factor Breakdown -->
                    <div class="sentiment-factors-v2" id="sentiment-factors"></div>
                </div>
            </div>
            <!-- SPX Institutional Strip (full width) -->
            <div class="spx-strip" id="spx-strip">
                <div class="spx-strip-label">SPX INSTITUTIONAL</div>
                <div class="spx-strip-items">
                    <div class="spx-strip-item">
                        <span class="spx-strip-key">GEX</span>
                        <span class="spx-strip-val" id="spx-gex-value">--</span>
                    </div>
                    <div class="spx-strip-item">
                        <span class="spx-strip-key">IV Rank</span>
                        <span class="spx-strip-val" id="spx-iv-rank">--</span>
                    </div>
                    <div class="spx-strip-item">
                        <span class="spx-strip-key">IV Pctl</span>
                        <span class="spx-strip-val" id="spx-iv-pctl">--</span>
                    </div>
                    <div class="spx-strip-item">
                        <span class="spx-strip-key">Skew</span>
                        <span class="spx-strip-val" id="spx-skew-ratio">--</span>
                    </div>
                    <div class="spx-strip-item">
                        <span class="spx-strip-key">RV 20d</span>
                        <span class="spx-strip-val" id="spx-rv-20d">--</span>
                    </div>
                    <div class="spx-strip-item">
                        <span class="spx-strip-key">Max Pain</span>
                        <span class="spx-strip-val" id="spx-max-pain">--</span>
                    </div>
                    <div class="spx-strip-item">
                        <span class="spx-strip-key">0DTE Vol</span>
                        <span class="spx-strip-val" id="spx-0dte-vol">--</span>
                    </div>
                </div>
            </div>
            <!-- Expiry selector -->
            <div class="expiry-bar">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 0.7rem; color: var(--text-muted);">SPY Expiry:</span>
                    <select id="market-sentiment-expiry" onchange="loadMarketSentimentForExpiry()">
                        <option value="">Loading...</option>
                    </select>
                </div>
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 0.65rem; color: var(--text-muted);" id="spy-call-put-oi">--</span>
                    <button class="btn btn-ghost" onclick="loadMarketSentiment()" style="font-size: 0.7rem; padding: 4px 10px;">Refresh</button>
                </div>
            </div>
        </div>

        <!-- Quick Ticker Shortcuts -->
        <div class="quick-tickers">
            <span style="font-size: 0.75rem; color: var(--text-muted); padding: 6px 0;">Equities:</span>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('SPY')" title="SPDR S&P 500 ETF">SPY</button>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('QQQ')" title="Invesco Nasdaq 100 ETF">QQQ</button>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('NVDA')" title="NVIDIA Corporation">NVDA</button>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('TSLA')" title="Tesla Inc">TSLA</button>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('AAPL')" title="Apple Inc">AAPL</button>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('AMD')" title="Advanced Micro Devices">AMD</button>
            <button class="btn btn-ghost ticker-btn" onclick="quickAnalyzeTicker('META')" title="Meta Platforms">META</button>
            <span class="ticker-divider"></span>
            <span style="font-size: 0.75rem; color: var(--orange); padding: 6px 0;">Futures:</span>
            <button class="btn btn-ghost ticker-btn futures-btn" onclick="quickAnalyzeTicker('/ES')" title="E-mini S&P 500">/ES</button>
            <button class="btn btn-ghost ticker-btn futures-btn" onclick="quickAnalyzeTicker('/NQ')" title="E-mini Nasdaq">/NQ</button>
            <button class="btn btn-ghost ticker-btn futures-btn" onclick="quickAnalyzeTicker('/CL')" title="Crude Oil">/CL</button>
            <button class="btn btn-ghost ticker-btn futures-btn" onclick="quickAnalyzeTicker('/GC')" title="Gold">/GC</button>
        </div>

        <!-- Search & Action Bar -->
        <div class="filter-bar" style="margin-bottom: 16px; flex-wrap: wrap;">
            <input type="text" id="options-ticker-input" placeholder="Enter ticker..."
                style="flex: 1; min-width: 120px; max-width: 180px; padding: 8px 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 0.875rem;"
                oninput="document.getElementById('ticker-input').value=this.value"
                onkeypress="if(event.key==='Enter') loadOptionsAnalysis()" />
            <button class="btn btn-primary" onclick="loadOptionsAnalysis()" style="padding: 8px 16px;">Analyze</button>
        </div>

        <!-- Tab Bar -->
        <div class="tab-bar">
            <button class="tab-btn active" data-tab="tab-analysis" onclick="showTab('tab-analysis')" title="Options sentiment, expected move, IV smile, GEX dashboard, and regime analysis">
                Dashboard
                <span class="tab-accent"></span>
            </button>
            <button class="tab-btn" data-tab="tab-chart" onclick="showTab('tab-chart')" title="Full-screen price chart with technical indicators, GEX overlays, and volume">
                Chart
                <span class="tab-accent"></span>
            </button>
            <button class="tab-btn" data-tab="tab-trade" onclick="showTab('tab-trade')" title="Scanner, X-Ray analysis, swing trades, paper trading, and 0DTE engine">
                Trade
                <span class="tab-accent"></span>
            </button>
        </div>

        <!-- ===== TAB: ANALYSIS ===== -->
        <div class="tab-content active" id="tab-analysis">

            <!-- Options Analysis Container -->
            <div id="options-analysis-container" class="card" style="display: none; margin-bottom: 20px; border-left: 3px solid var(--blue);">
                <div class="card-header">
                    <div class="card-title">Options Analysis <span id="oa-ticker" style="color: var(--blue); margin-left: 8px;"></span></div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <select id="oa-expiry-select" onchange="loadOptionsForExpiry()">
                            <option value="">Select expiration...</option>
                        </select>
                        <div class="dte-buttons">
                            <button class="btn btn-ghost dte-btn-wrap" onclick="selectExpiryByDays(0)" title="0DTE">0D</button>
                            <button class="btn btn-ghost dte-btn-wrap" onclick="selectExpiryByDays(7)" title="~1 Week">1W</button>
                            <button class="btn btn-ghost dte-btn-wrap" onclick="selectExpiryByDays(30)" title="~1 Month">1M</button>
                            <button class="btn btn-ghost dte-btn-wrap" onclick="selectExpiryByDays(90)" title="~3 Months">3M</button>
                        </div>
                        <div id="oa-sentiment" class="sentiment-badge">--</div>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Main Metrics Row -->
                    <div class="metrics-grid-5">
                        <div class="metric-box" title="Put/Call Ratio for this expiration. Below 0.7 = bullish, 0.7-1.0 = neutral, above 1.0 = bearish.">
                            <div class="metric-label">P/C RATIO</div>
                            <div class="metric-value" id="oa-pc-ratio">--</div>
                            <div class="metric-sub" id="oa-pc-label">--</div>
                        </div>
                        <div class="metric-box" id="oa-gex-card" style="cursor: pointer; border: 2px solid transparent;" onclick="showOptionsChart('gex')" title="Gamma Exposure - click to view GEX by strike chart. Positive = dealers stabilize price, Negative = dealers amplify moves.">
                            <div class="metric-label">GEX <span class="info-icon" data-tooltip="Gamma Exposure: Positive GEX = stabilizing. Negative GEX = volatile.">i</span></div>
                            <div class="metric-value" id="oa-gex">--</div>
                            <div class="metric-sub" id="oa-gex-label">--</div>
                        </div>
                        <div class="metric-box" title="IV Rank - where current implied volatility sits vs its 52-week range. High (>50%) = IV is expensive, favor selling. Low (<30%) = IV is cheap, favor buying.">
                            <div class="metric-label">IV RANK <span class="info-icon" data-tooltip="Where current IV sits vs past year. High = sell, Low = buy.">i</span></div>
                            <div class="metric-value" id="oa-iv-rank">--</div>
                            <div class="metric-sub" id="oa-iv-label">--</div>
                        </div>
                        <div class="metric-box" id="oa-maxpain-card" style="cursor: pointer; border: 2px solid var(--purple);" onclick="showOptionsChart('maxpain')" title="Max Pain - click to view pain chart. The strike where option writers lose the least. Price tends to pin here at expiration.">
                            <div class="metric-label">MAX PAIN <span class="info-icon" data-tooltip="Strike where option writers lose the least. Stocks gravitate here near expiry.">i</span></div>
                            <div class="metric-value" id="oa-max-pain" style="color: var(--purple);">--</div>
                            <div class="metric-sub" id="oa-mp-distance">--</div>
                        </div>
                        <div class="metric-box" title="Current price of the underlying asset, updated in real-time via WebSocket streaming.">
                            <div class="metric-label">CURRENT</div>
                            <div class="metric-value" id="oa-current-price">--</div>
                            <div class="metric-sub" id="oa-dte">--</div>
                        </div>
                    </div>
                    <!-- OI Stats Row -->
                    <div class="oi-stats-row">
                        <div title="Total open interest on call options for this expiration"><span class="stat-label">Call OI:</span> <span class="stat-value green" id="oa-call-oi">--</span></div>
                        <div class="divider"></div>
                        <div title="Total open interest on put options for this expiration"><span class="stat-label">Put OI:</span> <span class="stat-value red" id="oa-put-oi">--</span></div>
                        <div class="divider"></div>
                        <div><span class="stat-label">Expiry:</span> <span class="stat-value" id="oa-expiry-display">--</span></div>
                    </div>
                    <!-- Options Chart (Max Pain / GEX toggle) -->
                    <div id="oa-chart-container" style="margin-top: 16px;">
                        <div id="oa-chart-title" style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 8px;">Pain by Strike Price</div>
                        <div id="oa-chart" style="background: var(--bg-hover); border-radius: 8px; padding: 16px; min-height: 160px;">
                            <div style="color: var(--text-muted); font-size: 0.8rem; text-align: center; padding: 40px;">
                                Enter a ticker and click Analyze to see options data
                            </div>
                        </div>
                        <div id="oa-chart-legend" style="display: flex; justify-content: center; gap: 20px; margin-top: 8px; font-size: 0.7rem;">
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div style="width: 12px; height: 12px; background: var(--purple); border-radius: 2px;"></div>
                                <span style="color: var(--text-muted);">Max Pain Strike</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <div style="width: 12px; height: 2px; background: var(--blue);"></div>
                                <span style="color: var(--text-muted);">Current Price</span>
                            </div>
                        </div>
                    </div>

                    <!-- Interpretation -->
                    <div class="interpretation-box" id="oa-interpretation" style="margin-top: 12px;">
                        Enter a ticker and click Analyze to see options sentiment and max pain analysis.
                    </div>
                </div>
            </div>

            <!-- Expected Move Card -->
            <div class="em-card" id="expected-move-card" style="display: none;" title="Expected Move - the range the market is pricing in based on implied volatility. 1 SD = 68% probability, 1.5 SD = 87%, 2 SD = 95%.">
                <div class="em-card-header">
                    <div class="em-card-title">EXPECTED MOVE</div>
                    <div class="em-dte-badge" id="em-dte-badge" title="Days to expiration for this expected move calculation">-- DTE</div>
                </div>
                <div class="em-levels-row">
                    <div>
                        <span style="color: var(--red); font-weight: 600;" id="em-sd2-lower">--</span>
                        <span style="color: var(--text-muted); font-size: 0.7rem; margin-left: 4px;" title="95% chance price stays above this level">-2 SD</span>
                    </div>
                    <div>
                        <span style="color: var(--orange); font-weight: 600;" id="em-sd1-lower">--</span>
                        <span style="color: var(--text-muted); font-size: 0.7rem; margin-left: 4px;" title="68% chance price stays above this level">-1 SD</span>
                    </div>
                    <div style="text-align: center;">
                        <span style="color: var(--text); font-weight: 700; font-size: 1rem;" id="em-current">--</span>
                    </div>
                    <div>
                        <span style="color: var(--text-muted); font-size: 0.7rem; margin-right: 4px;" title="68% chance price stays below this level">+1 SD</span>
                        <span style="color: var(--orange); font-weight: 600;" id="em-sd1-upper">--</span>
                    </div>
                    <div>
                        <span style="color: var(--text-muted); font-size: 0.7rem; margin-right: 4px;" title="95% chance price stays below this level">+2 SD</span>
                        <span style="color: var(--red); font-weight: 600;" id="em-sd2-upper">--</span>
                    </div>
                </div>
                <div class="em-range-container" id="em-range-container">
                    <!-- Bars filled by JS -->
                </div>
                <div class="em-legend">
                    <div class="em-legend-item">
                        <div class="em-legend-dot" style="background: rgba(34, 197, 94, 0.4);"></div>
                        <span>68% (1 SD)</span>
                    </div>
                    <div class="em-legend-item">
                        <div class="em-legend-dot" style="background: rgba(249, 115, 22, 0.35);"></div>
                        <span>87% (1.5 SD)</span>
                    </div>
                    <div class="em-legend-item">
                        <div class="em-legend-dot" style="background: rgba(239, 68, 68, 0.25);"></div>
                        <span>95% (2 SD)</span>
                    </div>
                </div>
            </div>

            <!-- IV Smile / Skew Chart -->
            <div class="iv-smile-container" id="iv-smile-container" style="display: none;">
                <div class="iv-smile-header" title="Implied Volatility Smile - shows how IV varies by strike price. Steep left skew = fear of downside. Flat = balanced expectations.">IV SMILE / SKEW</div>
                <div id="iv-smile-chart"></div>
            </div>

            <!-- F9: Term Structure Visualization -->
            <div class="term-structure-container" id="term-structure-container" style="display: none;">
                <div class="term-structure-header">IV TERM STRUCTURE</div>
                <div id="term-structure-label" style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 8px;"></div>
                <div id="term-structure-chart" style="min-height: 220px;"></div>
            </div>

            <!-- Section Divider: GEX Dashboard -->
            <div class="tab-section-divider">
                <span class="tab-section-label" style="color: var(--orange);">GEX DASHBOARD</span>
            </div>

            <!-- GEX Dashboard -->
            <div id="gex-dashboard-container" class="card" style="display: none; margin-bottom: 20px; border-left: 3px solid var(--orange);">
                <div class="card-header">
                    <div class="card-title">GEX Dashboard <span id="gex-ticker" style="color: var(--orange); margin-left: 8px;"></span></div>
                    <button class="btn btn-primary" onclick="loadGexDashboard()">Refresh GEX</button>
                </div>
                <div class="card-body">
                    <!-- Regime Row -->
                    <div class="regime-grid">
                        <!-- Volatility Regime -->
                        <div class="regime-box" title="GEX-based volatility regime. Positive Gamma = low vol (sell premium). Negative Gamma = high vol (buy protection). Transition = mixed signals.">
                            <div class="regime-header">VOLATILITY REGIME</div>
                            <div class="regime-content">
                                <div id="gex-regime-badge" class="regime-badge">--</div>
                                <div class="regime-stats">
                                    <div><span class="stat-label">Confidence:</span> <span id="gex-regime-confidence">--</span></div>
                                    <div><span class="stat-label">Strategy:</span> <span id="gex-regime-strategy">--</span></div>
                                </div>
                            </div>
                            <div class="regime-rec" id="gex-regime-recommendation">--</div>
                        </div>
                        <!-- Combined Regime -->
                        <div class="regime-box" title="Combined regime using both GEX and Put/Call ratio Z-score. Provides risk level and position sizing guidance.">
                            <div class="regime-header">COMBINED REGIME (GEX + P/C)</div>
                            <div class="regime-content">
                                <div id="combined-regime-badge" class="regime-badge">--</div>
                                <div class="regime-stats">
                                    <div><span class="stat-label">Risk Level:</span> <span id="combined-risk-level">--</span></div>
                                    <div><span class="stat-label">Position Size:</span> <span id="combined-position-size">--</span></div>
                                </div>
                            </div>
                            <div class="regime-rec" id="combined-recommendation">--</div>
                        </div>
                    </div>
                    <!-- Key Levels Row -->
                    <div class="levels-grid">
                        <div class="level-box call-border" title="Strike with the highest call gamma exposure. Dealers are short calls here, so they sell as price rises - creating resistance.">
                            <div class="level-header">CALL WALL (RESIST)</div>
                            <div class="level-value call" id="gex-call-wall">--</div>
                            <div class="level-sub" id="gex-call-wall-dist">--</div>
                        </div>
                        <div class="level-box put-border" title="Strike with the highest put gamma exposure. Dealers are short puts here, so they buy as price falls - creating support.">
                            <div class="level-header">PUT WALL (SUPPORT)</div>
                            <div class="level-value put" id="gex-put-wall">--</div>
                            <div class="level-sub" id="gex-put-wall-dist">--</div>
                        </div>
                        <div class="level-box gamma-border" title="The strike where net gamma crosses zero. Above this level dealers stabilize price; below it they amplify moves.">
                            <div class="level-header">GAMMA FLIP</div>
                            <div class="level-value gamma" id="gex-gamma-flip">--</div>
                            <div class="level-sub" id="gex-gamma-flip-note">Sign change zone</div>
                        </div>
                        <div class="level-box purple-border" title="Z-score of current P/C ratio vs recent history. Above +1 = extreme bearish positioning, below -1 = extreme bullish.">
                            <div class="level-header">P/C RATIO Z-SCORE</div>
                            <div class="level-value" id="gex-pc-zscore">--</div>
                            <div class="level-sub" id="gex-pc-sentiment">--</div>
                        </div>
                    </div>
                    <!-- GEX Price Ladder -->
                    <div id="gex-price-ladder-container"></div>
                    <!-- Zones & Signals -->
                    <div class="zones-grid">
                        <div class="zone-box">
                            <div class="zone-header blue">Key Zones</div>
                            <div class="zone-content">
                                <div title="Strikes with high positive GEX that attract price - dealers push price toward these levels"><span class="stat-label">Magnet Zones:</span> <span id="gex-magnet-zones">--</span></div>
                                <div title="Strikes with negative GEX where price accelerates - dealers amplify moves past these levels"><span class="stat-label">Acceleration Zones:</span> <span id="gex-accel-zones">--</span></div>
                            </div>
                        </div>
                        <div class="zone-box">
                            <div class="zone-header purple">Trading Signal</div>
                            <div class="zone-content">
                                <div id="gex-signal-badge" class="signal-badge">--</div>
                                <div id="gex-signal-note" class="signal-note">--</div>
                            </div>
                        </div>
                    </div>
                    <!-- Interpretation -->
                    <div class="interpretation-box orange" id="gex-interpretation">
                        Load a ticker to see comprehensive GEX analysis with regime classification, support/resistance levels, and trading signals.
                    </div>
                    <!-- Key Levels Table (Collapsible) -->
                    <div id="gex-levels-table-container" style="display: none; margin-top: 12px;">
                        <div id="gex-levels-table-header" onclick="toggleGexLevelsTable()" class="table-toggle-header">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span id="gex-levels-toggle-icon" class="toggle-icon">&#9654;</span>
                                <span style="font-size: 0.7rem; font-weight: 600; color: var(--text-muted);">DETAILED KEY LEVELS</span>
                                <span id="gex-levels-count" class="levels-count">0 levels</span>
                            </div>
                            <span style="font-size: 0.65rem; color: var(--text-muted);">Click to expand</span>
                        </div>
                        <div id="gex-levels-table-body" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- GEX by Strike Table -->
            <div class="card" style="margin-bottom: 20px;">
                <div class="card-header">
                    <span>GEX by Strike</span>
                    <span class="level-count" id="gex-strike-count">-- levels</span>
                </div>
                <div class="card-body table-body" id="gex-table-container">
                    <table class="gex-table">
                        <thead>
                            <tr>
                                <th title="Option strike price">Strike</th>
                                <th title="Gamma exposure from call options at this strike">Call GEX</th>
                                <th title="Gamma exposure from put options at this strike">Put GEX</th>
                                <th title="Net gamma exposure (Call GEX - Put GEX). Positive = stabilizing, Negative = amplifying.">Net GEX</th>
                                <th title="Total call open interest at this strike">Call OI</th>
                                <th title="Total put open interest at this strike">Put OI</th>
                            </tr>
                        </thead>
                        <tbody id="gex-table-body">
                            <tr><td colspan="6" class="loading">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div><!-- end tab-analysis -->

        <!-- ===== TAB: TRADE (Scanner + X-Ray + Trading) ===== -->
        <div class="tab-content" id="tab-trade">

            <!-- ‚îÄ‚îÄ SECTION: SCANNER ‚îÄ‚îÄ -->
            <div class="tab-section-divider">
                <span class="tab-section-label" style="color: var(--magenta);">BEST SETUP SCANNER</span>
            </div>
            <div class="card" style="margin-bottom: 20px; border-left: 3px solid var(--magenta);">
                <div class="card-header">
                    <div class="card-title">BEST SETUP SCANNER</div>
                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <span id="scanner-status" style="font-size: 0.7rem; color: var(--text-muted);"></span>
                        <span id="scanner-timestamp" style="font-size: 0.65rem; color: var(--text-dim);"></span>
                        <button class="btn btn-primary" id="scanner-scan-btn" onclick="runBestSetupScanner()" style="background: var(--magenta); border-color: var(--magenta);">Scan All</button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="scanner-progress" style="display: none;"></div>
                    <div id="scanner-filter-bar">
                        <button class="scanner-filter-btn active" onclick="setScannerFilter('overall')">Best Edge</button>
                        <button class="scanner-filter-btn" onclick="setScannerFilter('buycalls')">Buy Calls</button>
                        <button class="scanner-filter-btn" onclick="setScannerFilter('buyputs')">Buy Puts</button>
                        <button class="scanner-filter-btn" onclick="setScannerFilter('sellpremium')">Sell Premium</button>
                        <button class="scanner-filter-btn" onclick="setScannerFilter('squeeze')">Highest Squeeze</button>
                        <button class="scanner-filter-btn" onclick="setScannerFilter('momentum')">Momentum</button>
                    </div>
                    <div id="scanner-results"></div>
                    <div id="scanner-placeholder" style="text-align: center; color: var(--text-muted); font-size: 0.8rem; padding: 30px 20px;">
                        Scans X-Ray with PhD intelligence across <strong>MAG 7 + SPY + QQQ + IBIT + GLD</strong> ‚Äî edge score, regime detection, VRP, flow toxicity, strategy selection.<br>
                        <span style="font-size: 0.7rem; color: var(--text-dim); margin-top: 6px; display: inline-block;">Click <strong>Scan All</strong> to begin.</span>
                    </div>
                </div>
            </div>
            <!-- Drill-down X-Ray detail for selected ticker -->
            <div id="scanner-xray-detail" class="card" style="display: none; margin-bottom: 20px; border-left: 3px solid var(--cyan);"></div>

            <!-- ‚îÄ‚îÄ SECTION: X-RAY & SWING TRADES ‚îÄ‚îÄ -->
            <div class="tab-section-divider">
                <span class="tab-section-label" style="color: var(--purple);">X-RAY & SWING TRADES</span>
            </div>

            <!-- Active Swing Trades -->
            <div id="swing-trades-container" class="card" style="display: none; margin-bottom: 20px;">
                <div class="card-header">
                    <div class="card-title">Active Trades <span id="swing-trade-count" style="color: var(--blue); margin-left: 8px;">0</span></div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span id="swing-last-refresh" style="font-size: 0.7rem; color: var(--text-muted);"></span>
                        <button class="btn btn-primary" onclick="refreshSwingTrades()" id="swing-refresh-btn">Refresh All</button>
                    </div>
                </div>
                <div class="card-body" id="swing-trades-list">
                    <!-- Trade cards rendered by JS -->
                </div>
            </div>

            <!-- Market X-Ray - Institutional Edge Scanner -->
            <div id="xray-container" class="card" style="margin-bottom: 20px; border-left: 3px solid var(--cyan);">
                <div class="card-header">
                    <div class="card-title">MARKET X-RAY <span id="xray-ticker" style="color: var(--cyan); margin-left: 8px;"></span></div>
                    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                        <select id="xray-expiry-select" style="padding:4px 8px;background:var(--bg);border:1px solid var(--border);border-radius:4px;color:var(--text);font-size:0.75rem;max-width:160px;">
                            <option value="">Auto (nearest)</option>
                        </select>
                        <label class="toggle-item swing-toggle" title="Swing Mode ‚Äî optimizes for 21-45 DTE swing trades">
                            <input type="checkbox" id="xray-swing-mode" onchange="onSwingModeToggle()">
                            <span class="toggle-label" style="color:var(--purple);font-weight:600;font-size:0.72rem;">Swing</span>
                        </label>
                        <div id="xray-composite-badge" style="font-size: 0.8rem; font-weight: 700; padding: 4px 14px; border-radius: 6px; background: var(--bg-hover); color: var(--text-muted);">SCORE: --</div>
                        <button class="btn btn-primary" id="xray-scan-btn" onclick="loadMarketXray()">Scan</button>
                    </div>
                </div>
                <div class="card-body" id="xray-body">
                    <!-- Verdict Banner -->
                    <div id="xray-verdict-banner" class="verdict-banner" style="display: none;">
                        <div class="verdict-text" id="xray-verdict">--</div>
                        <div class="verdict-rec" id="xray-interpretation">Click Scan to analyze market microstructure</div>
                    </div>

                    <!-- Trade Ideas -->
                    <div id="xray-trade-ideas" style="display: none;"></div>

                    <!-- Composite Score Section -->
                    <div class="xray-section" id="xray-sec-composite">
                        <div class="xray-section-header" onclick="toggleXraySection('composite')">
                            <span>Composite Edge Score</span>
                            <span class="xray-toggle" id="xray-toggle-composite">&#9660;</span>
                        </div>
                        <div class="xray-section-body" id="xray-content-composite" style="display: none;"></div>
                    </div>

                    <!-- Dealer Hedging Flow -->
                    <div class="xray-section" id="xray-sec-dealer">
                        <div class="xray-section-header" onclick="toggleXraySection('dealer')">
                            <span>Dealer Hedging Flow Map</span>
                            <span class="xray-toggle" id="xray-toggle-dealer">&#9660;</span>
                        </div>
                        <div class="xray-section-body" id="xray-content-dealer" style="display: none;"></div>
                    </div>

                    <!-- Gamma Squeeze / Pin Risk -->
                    <div class="xray-section" id="xray-sec-squeeze">
                        <div class="xray-section-header" onclick="toggleXraySection('squeeze')">
                            <span>Gamma Squeeze / Pin Risk</span>
                            <span class="xray-toggle" id="xray-toggle-squeeze">&#9660;</span>
                        </div>
                        <div class="xray-section-body" id="xray-content-squeeze" style="display: none;"></div>
                    </div>

                    <!-- Volatility Surface Distortion -->
                    <div class="xray-section" id="xray-sec-volsurface">
                        <div class="xray-section-header" onclick="toggleXraySection('volsurface')">
                            <span>Volatility Surface Distortion</span>
                            <span class="xray-toggle" id="xray-toggle-volsurface">&#9660;</span>
                        </div>
                        <div class="xray-section-body" id="xray-content-volsurface" style="display: none;"></div>
                    </div>

                    <!-- Smart Money Footprint -->
                    <div class="xray-section" id="xray-sec-smartmoney">
                        <div class="xray-section-header" onclick="toggleXraySection('smartmoney')">
                            <span>Smart Money Footprint</span>
                            <span class="xray-toggle" id="xray-toggle-smartmoney">&#9660;</span>
                        </div>
                        <div class="xray-section-body" id="xray-content-smartmoney" style="display: none;"></div>
                    </div>

                    <!-- Optimal Trade Zones -->
                    <div class="xray-section" id="xray-sec-tradezones">
                        <div class="xray-section-header" onclick="toggleXraySection('tradezones')">
                            <span>Optimal Trade Zones</span>
                            <span class="xray-toggle" id="xray-toggle-tradezones">&#9660;</span>
                        </div>
                        <div class="xray-section-body" id="xray-content-tradezones" style="display: none;"></div>
                    </div>

                    <!-- Default message -->
                    <div id="xray-placeholder" style="text-align: center; color: var(--text-muted); font-size: 0.8rem; padding: 20px;">
                        Click Scan to reveal hidden market dynamics beneath the price
                    </div>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ SECTION: PAPER TRADING & 0DTE ‚îÄ‚îÄ -->
            <div class="tab-section-divider">
                <span class="tab-section-label" style="color: var(--green);">PAPER TRADING & 0DTE</span>
            </div>

            <!-- Account Overview -->
            <div class="card trading-card" style="border-left: 3px solid var(--green); margin-bottom: 16px;">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="card-title" style="color: var(--green);">Paper Trading Dashboard</div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <span id="trading-status" class="trading-status-badge">‚óè OFFLINE</span>
                        <label class="toggle-switch" title="Enable/disable auto-trading">
                            <input type="checkbox" id="auto-trade-toggle" onchange="toggleAutoTrade()">
                            <span class="toggle-slider"></span>
                        </label>
                        <span style="font-size: 0.7rem; color: var(--text-muted);">Auto</span>
                        <label class="toggle-switch" title="Enable/disable multi-leg strategies">
                            <input type="checkbox" id="multi-leg-toggle" onchange="toggleMultiLeg()">
                            <span class="toggle-slider"></span>
                        </label>
                        <span style="font-size: 0.7rem; color: var(--text-muted);">Multi-Leg</span>
                        <label class="toggle-switch" title="Limited Risk = defined-risk spreads only. All = includes ratio spreads, naked positions">
                            <input type="checkbox" id="risk-mode-toggle" onchange="toggleRiskMode()">
                            <span class="toggle-slider"></span>
                        </label>
                        <span id="risk-mode-label" style="font-size: 0.7rem; color: var(--text-muted);">Limited Risk</span>
                        <button class="btn btn-ghost" onclick="triggerSignalCheck(event)" style="padding: 4px 10px; font-size: 0.75rem;" title="Manually check signals now">Check Signals</button>
                        <button class="btn btn-ghost" onclick="refreshTradingDashboard()" style="padding: 4px 10px; font-size: 0.75rem;" title="Refresh all data">Refresh</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="trading-metrics-grid">
                        <div class="trading-metric">
                            <div class="trading-metric-label">EQUITY</div>
                            <div class="trading-metric-value" id="trading-equity">$50,000</div><span class="sparkline-container" id="sparkline-equity"></span>
                        </div>
                        <div class="trading-metric">
                            <div class="trading-metric-label">CASH</div>
                            <div class="trading-metric-value" id="trading-cash">$50,000</div>
                        </div>
                        <div class="trading-metric">
                            <div class="trading-metric-label">BUYING POWER</div>
                            <div class="trading-metric-value" id="trading-buying-power">$50,000</div>
                        </div>
                        <div class="trading-metric">
                            <div class="trading-metric-label">TOTAL P&L</div>
                            <div class="trading-metric-value" id="trading-total-pnl">$0</div>
                        </div>
                        <div class="trading-metric">
                            <div class="trading-metric-label">TODAY P&L</div>
                            <div class="trading-metric-value" id="trading-daily-pnl">$0</div><span class="sparkline-container" id="sparkline-daily-pnl"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Portfolio Intelligence Strip -->
            <div class="portfolio-intel-strip" id="portfolio-intel-strip" style="margin-bottom: 16px;">
                <div class="intel-strip-header">
                    <span class="intel-strip-label">PORTFOLIO INTELLIGENCE</span>
                    <span class="intel-strip-timestamp" id="intel-strip-ts"></span>
                </div>
                <div class="intel-strip-grid">
                    <div class="intel-strip-metric" title="Total daily theta decay across all open positions">
                        <div class="intel-strip-metric-label">DAILY THETA</div>
                        <div class="intel-strip-metric-value" id="intel-daily-theta">--</div>
                    </div>
                    <div class="intel-strip-metric" title="Net portfolio delta exposure (directional risk)">
                        <div class="intel-strip-metric-label">NET DELTA</div>
                        <div class="intel-strip-metric-value" id="intel-net-delta">--</div>
                    </div>
                    <div class="intel-strip-metric" title="Net portfolio gamma (convexity exposure)">
                        <div class="intel-strip-metric-label">NET GAMMA</div>
                        <div class="intel-strip-metric-value" id="intel-net-gamma">--</div>
                    </div>
                    <div class="intel-strip-metric" title="Current GEX-based market regime from combined regime analysis">
                        <div class="intel-strip-metric-label">REGIME</div>
                        <div class="intel-strip-metric-value" id="intel-regime">--</div>
                    </div>
                    <div class="intel-strip-metric" title="Volatility Risk Premium: IV minus RV. Positive = premium sellers have edge">
                        <div class="intel-strip-metric-label">VRP</div>
                        <div class="intel-strip-metric-value" id="intel-vrp">--</div>
                    </div>
                    <div class="intel-strip-metric" title="Portfolio risk level based on current positions and regime">
                        <div class="intel-strip-metric-label">RISK</div>
                        <div class="intel-strip-metric-value" id="intel-risk">--</div>
                    </div>
                    <div class="intel-strip-metric" title="Average correlation across held positions (diversification measure)">
                        <div class="intel-strip-metric-label">CORRELATION</div>
                        <div class="intel-strip-metric-value" id="intel-correlation">--</div>
                    </div>
                </div>
            </div>

            <!-- 0DTE SPX Engine -->
            <div class="card trading-card zero-dte-section" style="border-left: 3px solid var(--red); margin-bottom: 16px;">
                <div class="card-header" style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="card-title" style="color: var(--red);">0DTE SPX Engine</div>
                        <label class="toggle-switch" title="Enable/disable 0DTE engine">
                            <input type="checkbox" id="toggle-0dte" onchange="toggle0DTE()">
                            <span class="toggle-slider"></span>
                        </label>
                        <span style="font-size: 0.7rem; color: var(--text-muted);">Enable</span>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <span id="zero-dte-status-badge" style="font-size: 0.65rem; padding: 2px 8px; border-radius: 8px; background: rgba(239,68,68,0.15); color: var(--red);">DISABLED</span>
                        <button class="btn btn-sm" style="font-size: 0.7rem; padding: 3px 10px; background: var(--red); color: #fff; border: none; border-radius: 4px; cursor: pointer;" onclick="trigger0DTESignalCheck(event)" title="Manual signal check">Check Now</button>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Circuit Breaker Alert -->
                    <div id="zero-dte-circuit-breaker" class="zero-dte-circuit-breaker" style="display: none;">
                        CIRCUIT BREAKER ACTIVE ‚Äî No new 0DTE trades until tomorrow
                    </div>

                    <!-- GEX Levels Strip -->
                    <div class="portfolio-intel-strip zero-dte-gex-strip" style="margin-bottom: 12px;">
                        <div class="intel-strip-header">
                            <span class="intel-strip-label">0DTE GEX Levels</span>
                            <span class="intel-strip-timestamp" id="zero-dte-gex-ts"></span>
                        </div>
                        <div class="intel-strip-grid">
                            <div class="intel-strip-metric" title="Current SPX price from 0DTE chain">
                                <div class="intel-strip-metric-label">SPX</div>
                                <div class="intel-strip-metric-value" id="zero-dte-spx">--</div>
                            </div>
                            <div class="intel-strip-metric" title="Largest call GEX strike (resistance)">
                                <div class="intel-strip-metric-label">CALL WALL</div>
                                <div class="intel-strip-metric-value" id="zero-dte-call-wall">--</div>
                            </div>
                            <div class="intel-strip-metric" title="Largest put GEX strike (support)">
                                <div class="intel-strip-metric-label">PUT WALL</div>
                                <div class="intel-strip-metric-value" id="zero-dte-put-wall">--</div>
                            </div>
                            <div class="intel-strip-metric" title="Zero-gamma level">
                                <div class="intel-strip-metric-label">GAMMA FLIP</div>
                                <div class="intel-strip-metric-value" id="zero-dte-gamma-flip">--</div>
                            </div>
                            <div class="intel-strip-metric" title="Max pain strike for 0DTE">
                                <div class="intel-strip-metric-label">MAX PAIN</div>
                                <div class="intel-strip-metric-value" id="zero-dte-max-pain">--</div>
                            </div>
                            <div class="intel-strip-metric" title="Positive = suppressive, Negative = amplifying">
                                <div class="intel-strip-metric-label">GEX SIGN</div>
                                <div class="intel-strip-metric-value" id="zero-dte-gex-sign">--</div>
                            </div>
                            <div class="intel-strip-metric" title="0-100 convergence to max pain">
                                <div class="intel-strip-metric-label">PIN SCORE</div>
                                <div class="intel-strip-metric-value" id="zero-dte-pin-score">--</div>
                            </div>
                            <div class="intel-strip-metric" title="VIX index level">
                                <div class="intel-strip-metric-label">VIX</div>
                                <div class="intel-strip-metric-value" id="zero-dte-vix">--</div>
                            </div>
                            <div class="intel-strip-metric" title="VIX1D / VIX ratio">
                                <div class="intel-strip-metric-label">VIX1D</div>
                                <div class="intel-strip-metric-value" id="zero-dte-vix1d">--</div>
                            </div>
                            <div class="intel-strip-metric" title="Net charm exposure bias">
                                <div class="intel-strip-metric-label">CHARM</div>
                                <div class="intel-strip-metric-value" id="zero-dte-charm">--</div>
                            </div>
                        </div>
                    </div>

                    <!-- Market Conditions Strip -->
                    <div id="zero-dte-market-conditions" style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 10px;"></div>

                    <!-- Opening Range Indicator -->
                    <div id="zero-dte-opening-range" style="margin-bottom: 10px; display: none;"></div>

                    <!-- Strategy Toggles -->
                    <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px;">
                        <span class="zero-dte-strategy-pill active" id="pill-iron_condor_walls" onclick="toggle0DTEStrategy('iron_condor_walls')" title="IC at GEX Walls">IC Walls</span>
                        <span class="zero-dte-strategy-pill active" id="pill-credit_spread_fade" onclick="toggle0DTEStrategy('credit_spread_fade')" title="Credit Spread Fade">CS Fade</span>
                        <span class="zero-dte-strategy-pill active" id="pill-pin_butterfly" onclick="toggle0DTEStrategy('pin_butterfly')" title="Pin Butterfly">Pin Fly</span>
                        <span class="zero-dte-strategy-pill active" id="pill-directional_momentum" onclick="toggle0DTEStrategy('directional_momentum')" title="Directional Momentum">Momentum</span>
                        <span class="zero-dte-strategy-pill active" id="pill-gamma_scalp_straddle" onclick="toggle0DTEStrategy('gamma_scalp_straddle')" title="Gamma Scalp (ES Delta-Hedged)">Gamma Scalp</span>
                        <span class="zero-dte-strategy-pill active" id="pill-opening_range_breakout" onclick="toggle0DTEStrategy('opening_range_breakout')" title="Opening Range Breakout">ORB</span>
                    </div>

                    <!-- Condition Gates Display -->
                    <div id="zero-dte-condition-gates" style="margin-bottom: 10px;"></div>

                    <!-- Daily Summary -->
                    <div class="trading-metrics-grid" style="margin-bottom: 12px;">
                        <div class="trading-metric">
                            <div class="trading-metric-label">TRADES TODAY</div>
                            <div class="trading-metric-value" id="zero-dte-trades-today">0</div>
                        </div>
                        <div class="trading-metric">
                            <div class="trading-metric-label">0DTE P&L</div>
                            <div class="trading-metric-value" id="zero-dte-pnl">$0</div>
                        </div>
                        <div class="trading-metric">
                            <div class="trading-metric-label">WIN RATE</div>
                            <div class="trading-metric-value" id="zero-dte-win-rate">0%</div>
                        </div>
                        <div class="trading-metric">
                            <div class="trading-metric-label">OPEN POS</div>
                            <div class="trading-metric-value" id="zero-dte-open-pos">0</div>
                        </div>
                        <div class="trading-metric">
                            <div class="trading-metric-label">WEEKLY P&L</div>
                            <div class="trading-metric-value" id="zero-dte-weekly-pnl">$0</div>
                        </div>
                        <div class="trading-metric">
                            <div class="trading-metric-label">MONTHLY P&L</div>
                            <div class="trading-metric-value" id="zero-dte-monthly-pnl">$0</div>
                        </div>
                    </div>

                    <!-- Kelly Sizing Table -->
                    <div id="zero-dte-kelly-sizing" style="margin-bottom: 10px;"></div>

                    <!-- 0DTE Positions Table -->
                    <div id="zero-dte-positions" style="max-height: 200px; overflow-y: auto;">
                        <div style="text-align: center; color: var(--text-muted); padding: 12px; font-size: 0.75rem;">No 0DTE positions</div>
                    </div>
                </div>
            </div>

            <!-- Signals & Risk Row -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">

                <!-- Active Signals -->
                <div class="card trading-card" style="border-left: 3px solid var(--orange);">
                    <div class="card-header">
                        <div class="card-title" style="color: var(--orange);">Active Signals</div>
                    </div>
                    <div class="card-body" id="trading-signals" style="max-height: 250px; overflow-y: auto;">
                        <div style="text-align: center; color: var(--text-muted); padding: 20px; font-size: 0.8rem;">No signals yet. Click "Check Signals" or enable auto-trade.</div>
                    </div>
                </div>

                <!-- Risk Limits -->
                <div class="card trading-card" style="border-left: 3px solid var(--purple);">
                    <div class="card-header">
                        <div class="card-title" style="color: var(--purple);">Risk & Config</div>
                    </div>
                    <div class="card-body" id="trading-risk" style="max-height: 250px; overflow-y: auto;">
                        <div style="text-align: center; color: var(--text-muted); padding: 20px; font-size: 0.8rem;">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Open Positions -->
            <div class="card trading-card" style="border-left: 3px solid var(--blue); margin-bottom: 16px;">
                <div class="card-header">
                    <div class="card-title" style="color: var(--blue);">Open Positions</div>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div id="trading-positions" style="overflow-x: auto;">
                        <div style="text-align: center; color: var(--text-muted); padding: 20px; font-size: 0.8rem;">No open positions</div>
                    </div>
                </div>
            </div>

            <!-- Equity Curve -->
            <div class="card trading-card" style="border-left: 3px solid var(--green); margin-bottom: 16px;">
                <div class="card-header">
                    <div class="card-title" style="color: var(--green);">Equity Curve</div>
                </div>
                <div class="card-body">
                    <div id="trading-equity-chart" style="height: 280px;"></div>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="card trading-card" style="border-left: 3px solid var(--cyan); margin-bottom: 16px;">
                <div class="card-header">
                    <div class="card-title" style="color: var(--cyan);">Performance Metrics</div>
                </div>
                <div class="card-body">
                    <div class="trading-metrics-grid" id="trading-performance">
                        <div class="trading-metric"><div class="trading-metric-label">WIN RATE</div><div class="trading-metric-value" id="perf-win-rate">--</div></div>
                        <div class="trading-metric"><div class="trading-metric-label">PROFIT FACTOR</div><div class="trading-metric-value" id="perf-profit-factor">--</div></div>
                        <div class="trading-metric"><div class="trading-metric-label">SHARPE RATIO</div><div class="trading-metric-value" id="perf-sharpe">--</div></div>
                        <div class="trading-metric"><div class="trading-metric-label">MAX DRAWDOWN</div><div class="trading-metric-value" id="perf-max-dd">--</div></div>
                        <div class="trading-metric"><div class="trading-metric-label">EXPECTANCY</div><div class="trading-metric-value" id="perf-expectancy">--</div></div>
                        <div class="trading-metric"><div class="trading-metric-label">AVG WIN</div><div class="trading-metric-value" id="perf-avg-win">--</div></div>
                        <div class="trading-metric"><div class="trading-metric-label">AVG LOSS</div><div class="trading-metric-value" id="perf-avg-loss">--</div></div>
                        <div class="trading-metric"><div class="trading-metric-label">TOTAL TRADES</div><div class="trading-metric-value" id="perf-total-trades">0</div></div>
                    </div>
                </div>
            </div>

            <!-- Strategy Breakdown & Signal Attribution Row -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">

                <!-- Strategy Breakdown -->
                <div class="card trading-card" style="border-left: 3px solid var(--magenta);">
                    <div class="card-header">
                        <div class="card-title" style="color: var(--magenta);">Strategy Breakdown</div>
                    </div>
                    <div class="card-body" id="trading-strategy-breakdown" style="max-height: 300px; overflow-y: auto;">
                        <div style="text-align: center; color: var(--text-muted); padding: 20px; font-size: 0.8rem;">No strategy data yet</div>
                    </div>
                </div>

                <!-- Signal Attribution -->
                <div class="card trading-card" style="border-left: 3px solid var(--yellow);">
                    <div class="card-header">
                        <div class="card-title" style="color: var(--yellow);">Signal Attribution</div>
                    </div>
                    <div class="card-body" id="trading-signal-attribution" style="max-height: 300px; overflow-y: auto;">
                        <div style="text-align: center; color: var(--text-muted); padding: 20px; font-size: 0.8rem;">No signal data yet</div>
                    </div>
                </div>
            </div>

            <!-- Strategy x Regime Matrix -->
            <div id="strategy-matrix-card" class="card trading-card" style="border-left: 3px solid var(--magenta, #e879f9); margin-bottom: 16px;">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="card-title" style="color: var(--magenta, #e879f9);">STRATEGY &times; REGIME MATRIX</div>
                        <span id="srm-regime-badge" class="srm-regime-badge">--</span>
                    </div>
                    <button class="btn btn-ghost" onclick="loadStrategyMatrix()" style="padding: 3px 8px; font-size: 0.7rem;">Refresh</button>
                </div>
                <div class="card-body" id="strategy-matrix-body">
                    <div class="srm-empty">Loading matrix...</div>
                </div>
            </div>

            <!-- Trade Journal -->
            <div class="card trading-card" style="border-left: 3px solid var(--text-muted); margin-bottom: 16px;">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="card-title">Trade Journal</div>
                    <div style="display: flex; gap: 6px;">
                        <button class="btn btn-ghost journal-filter active" data-filter="all" onclick="filterJournal('all')" style="padding: 3px 8px; font-size: 0.7rem;">All</button>
                        <button class="btn btn-ghost journal-filter" data-filter="open" onclick="filterJournal('open')" style="padding: 3px 8px; font-size: 0.7rem;">Open</button>
                        <button class="btn btn-ghost journal-filter" data-filter="closed" onclick="filterJournal('closed')" style="padding: 3px 8px; font-size: 0.7rem;">Closed</button>
                    </div>
                </div>
                <div class="card-body" style="padding: 0;">
                    <div id="trading-journal" style="overflow-x: auto;">
                        <div style="text-align: center; color: var(--text-muted); padding: 20px; font-size: 0.8rem;">No trades yet</div>
                    </div>
                </div>
            </div>

            <!-- Reset Button -->
            <div style="text-align: center; margin-top: 10px; margin-bottom: 20px;">
                <button class="btn btn-ghost" onclick="resetPaperAccount()" style="padding: 6px 16px; font-size: 0.75rem; color: var(--red); border-color: var(--red);" title="Reset paper account to starting capital. This clears all trades and equity history.">Reset Paper Account</button>
            </div>

        </div><!-- end tab-trade -->

        <!-- ===== TAB: CHART ===== -->
        <div class="tab-content" id="tab-chart">
            <div id="options-viz-container" class="card" style="display: none;">
                <div class="card-header">
                    <div class="card-title">CHART <span id="viz-ticker-label"></span> <span id="live-status" style="font-size: 0.65rem; font-weight: 500; margin-left: 8px; display: none;"><span id="live-status-dot" style="display: inline-block; width: 7px; height: 7px; border-radius: 50%; margin-right: 3px; vertical-align: middle;"></span><span id="live-status-text"></span></span></div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <div class="interval-selector">
                            <button class="interval-btn" onclick="setInterval_('1m')">1m</button>
                            <button class="interval-btn" onclick="setInterval_('5m')">5m</button>
                            <button class="interval-btn" onclick="setInterval_('15m')">15m</button>
                            <button class="interval-btn" onclick="setInterval_('1h')">1h</button>
                            <button class="interval-btn" onclick="setInterval_('4h')">4h</button>
                            <button class="interval-btn active" onclick="setInterval_('1d')">1D</button>
                            <button class="interval-btn" onclick="setInterval_('1w')">1W</button>
                        </div>
                        <div class="interval-selector">
                            <button class="interval-btn" id="btn-log-scale" onclick="toggleLogScale()" title="Toggle logarithmic price scale">Log</button>
                            <button class="interval-btn active" id="btn-auto-scale" onclick="toggleAutoScale()" title="Toggle auto-scale (fit price to visible range)">Auto</button>
                        </div>
                        <select id="viz-timeframe" onchange="refreshOptionsViz()" title="Chart timeframe - select how far back to show price history">
                            <option value="1825" selected>5Y</option>
                            <option value="7300">All</option>
                        </select>
                        <button class="btn btn-ghost" onclick="refreshOptionsViz()" title="Refresh">Refresh</button>
                        <button class="btn btn-ghost fullscreen-btn" onclick="toggleChartFullscreen()" title="Toggle fullscreen">&#x26F6;</button>
                    </div>
                </div>
                <!-- Toggle Preset Bar -->
                <div class="toggle-preset-bar">
                    <button class="preset-btn active" data-preset="options" onclick="applyTogglePreset('options')">Options</button>
                    <button class="preset-btn" data-preset="technicals" onclick="applyTogglePreset('technicals')">Technicals</button>
                    <button class="preset-btn" data-preset="intel" onclick="applyTogglePreset('intel')">Intel</button>
                    <button class="preset-btn preset-custom-btn" onclick="toggleCustomToggles()">Custom &#9662;</button>
                </div>
                <!-- Toggle Panel (collapsible) -->
                <div class="toggle-panels-wrapper" id="custom-toggles" style="display: none;">
                <div class="toggle-panel">
                    <label class="toggle-item" title="Call Wall - strike with highest call gamma. Acts as resistance; price tends to slow or reverse here.">
                        <input type="checkbox" id="viz-toggle-callwall" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label call">Call Wall</span>
                    </label>
                    <label class="toggle-item" title="Put Wall - strike with highest put gamma. Acts as support; dealers buy dips here.">
                        <input type="checkbox" id="viz-toggle-putwall" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label put">Put Wall</span>
                    </label>
                    <label class="toggle-item" title="Gamma Flip - strike where net GEX crosses from positive to negative. Above = stabilizing, below = volatile.">
                        <input type="checkbox" id="viz-toggle-gammaflip" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label gamma">Gamma Flip</span>
                    </label>
                    <label class="toggle-item" title="Max Pain - strike where option holders lose the most. Price gravitates here near expiry.">
                        <input type="checkbox" id="viz-toggle-maxpain" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label maxpain">Max Pain</span>
                    </label>
                    <span class="toggle-divider">|</span>
                    <label class="toggle-item" title="Value Area Low - bottom of the 70% volume zone. Acts as support.">
                        <input type="checkbox" id="viz-toggle-val" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label val">VAL</span>
                    </label>
                    <label class="toggle-item" title="Point of Control - price level with the highest traded volume. Strongest magnet level.">
                        <input type="checkbox" id="viz-toggle-poc" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label poc">POC</span>
                    </label>
                    <label class="toggle-item" title="Value Area High - top of the 70% volume zone. Acts as resistance.">
                        <input type="checkbox" id="viz-toggle-vah" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label vah">VAH</span>
                    </label>
                    <label class="toggle-item" title="Volume Profile histogram - horizontal bars showing volume at each price level.">
                        <input type="checkbox" id="viz-toggle-vp" onchange="toggleVolumeProfile()">
                        <span class="toggle-label vp">VP Hist</span>
                    </label>
                    <span class="toggle-divider">|</span>
                    <label class="toggle-item" title="Toggle the GEX by strike bar chart below the price chart.">
                        <input type="checkbox" id="viz-toggle-gex" checked onchange="toggleGexChart()">
                        <span class="toggle-label">GEX Chart</span>
                    </label>
                    <label class="toggle-item" title="Overlay whale trade markers on the price chart at trade timestamps.">
                        <input type="checkbox" id="viz-toggle-flow" onchange="toggleFlowMarkers()">
                        <span class="toggle-label" style="color: var(--magenta);">Flow</span>
                    </label>
                </div>
                <!-- Indicator Toggle Panel -->
                <div class="toggle-panel-indicators">
                    <label class="toggle-item" title="Simple Moving Average (20 period) - short-term trend">
                        <input type="checkbox" id="viz-toggle-sma20" onchange="updateIndicators()">
                        <span class="toggle-label sma20">SMA 20</span>
                    </label>
                    <label class="toggle-item" title="Simple Moving Average (50 period) - medium-term trend">
                        <input type="checkbox" id="viz-toggle-sma50" onchange="updateIndicators()">
                        <span class="toggle-label sma50">SMA 50</span>
                    </label>
                    <label class="toggle-item" title="Simple Moving Average (200 period) - long-term trend">
                        <input type="checkbox" id="viz-toggle-sma200" onchange="updateIndicators()">
                        <span class="toggle-label sma200">SMA 200</span>
                    </label>
                    <label class="toggle-item" title="Volume Weighted Average Price - institutional fair value">
                        <input type="checkbox" id="viz-toggle-vwap" onchange="updateIndicators()">
                        <span class="toggle-label vwap">VWAP</span>
                    </label>
                    <label class="toggle-item" title="Bollinger Bands (20, 2) - volatility envelope around SMA 20">
                        <input type="checkbox" id="viz-toggle-bb" onchange="updateIndicators()">
                        <span class="toggle-label bb">BB</span>
                    </label>
                    <span class="toggle-divider">|</span>
                    <label class="toggle-item" title="Relative Strength Index (14) - momentum oscillator 0-100">
                        <input type="checkbox" id="viz-toggle-rsi" onchange="toggleRsiChart()">
                        <span class="toggle-label rsi">RSI</span>
                    </label>
                    <label class="toggle-item" title="Relative Strength vs SPY - compares stock performance against S&P 500">
                        <input type="checkbox" id="viz-toggle-rs" onchange="toggleRsChart()">
                        <span class="toggle-label rs">RS</span>
                    </label>
                    <label class="toggle-item" title="CFTC Commitments of Traders - institutional positioning (futures only)">
                        <input type="checkbox" id="viz-toggle-cot" onchange="toggleCotChart()">
                        <span class="toggle-label cot">COT</span>
                    </label>
                    <label class="toggle-item" title="Volume bars at bottom of price chart">
                        <input type="checkbox" id="viz-toggle-volume" checked onchange="toggleVolumeSeries()">
                        <span class="toggle-label vol">Vol</span>
                    </label>
                    <span class="toggle-divider">|</span>
                    <span class="intel-toggle-group">INTEL:</span>
                    <label class="toggle-item" title="Expected Move envelope - 1-sigma boundaries from ATM straddle pricing">
                        <input type="checkbox" id="viz-toggle-em" checked onchange="updatePriceChartLevels()">
                        <span class="toggle-label em">EM</span>
                    </label>
                    <label class="toggle-item" title="GEX Regime badge - shows pinned/volatile/transitional with dealer recommendation">
                        <input type="checkbox" id="viz-toggle-regime" onchange="toggleRegimeBadge()">
                        <span class="toggle-label regime">Regime</span>
                    </label>
                    <label class="toggle-item" title="Volatility Risk Premium gauge - IV vs RV spread">
                        <input type="checkbox" id="viz-toggle-vrp" onchange="toggleVrpGauge()">
                        <span class="toggle-label vrp">VRP</span>
                    </label>
                    <label class="toggle-item" title="GEX Heatmap - top strikes by gamma exposure magnitude">
                        <input type="checkbox" id="viz-toggle-gexheat" onchange="toggleGexHeatmap()">
                        <span class="toggle-label gexheat">GEX Heat</span>
                    </label>
                    <label class="toggle-item" title="Flow toxicity gauge - measures toxic vs informed order flow">
                        <input type="checkbox" id="viz-toggle-toxicity" onchange="toggleFlowStrip()">
                        <span class="toggle-label toxicity">Toxicity</span>
                    </label>
                    <label class="toggle-item" title="Dealer flow direction badge - net hedging flow from vanna/charm/GEX">
                        <input type="checkbox" id="viz-toggle-dealer" onchange="toggleDealerBadge()">
                        <span class="toggle-label dealer">Dealer</span>
                    </label>
                </div>
                </div><!-- end toggle-panels-wrapper -->
                <!-- Fullscreen-only ticker bar -->
                <div class="fs-ticker-bar">
                    <input type="text" id="fs-ticker-input" placeholder="Ticker..." onkeypress="if(event.key==='Enter'){quickAnalyzeTicker(this.value.toUpperCase().trim());this.blur();}">
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('SPY')">SPY</button>
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('QQQ')">QQQ</button>
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('NVDA')">NVDA</button>
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('TSLA')">TSLA</button>
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('AAPL')">AAPL</button>
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('AMD')">AMD</button>
                    <button class="fs-tk-btn" onclick="quickAnalyzeTicker('META')">META</button>
                    <span style="color:var(--border);">|</span>
                    <button class="fs-tk-btn futures" onclick="quickAnalyzeTicker('/ES')">/ES</button>
                    <button class="fs-tk-btn futures" onclick="quickAnalyzeTicker('/NQ')">/NQ</button>
                    <button class="fs-tk-btn futures" onclick="quickAnalyzeTicker('/CL')">/CL</button>
                    <button class="fs-tk-btn futures" onclick="quickAnalyzeTicker('/GC')">/GC</button>
                </div>
                <div class="card-body chart-body" style="min-height: 600px;">
                    <div id="price-chart-container" class="chart-container" style="min-height: 500px;">
                        <div class="chart-loading">Loading price data...</div>
                    </div>
                    <div id="rsi-chart-container" class="chart-container rsi-pane" style="display:none;">
                    </div>
                    <div id="rs-chart-container" class="chart-container rs-pane" style="display:none;">
                    </div>
                    <div id="cot-chart-container" class="chart-container cot-pane" style="display:none;">
                    </div>
                    <div id="vrp-gauge-container" class="vrp-gauge" style="display:none;"></div>
                    <div id="flow-strip-container" class="flow-strip" style="display:none;"></div>
                    <div id="gex-chart-container" class="chart-container" style="height: 200px;">
                        <div class="chart-loading">Loading GEX data...</div>
                    </div>
                </div>
                <!-- Info Bar -->
                <div class="info-bar">
                    <div class="info-item" title="Live streaming price via Tastytrade WebSocket">
                        <span class="info-label">Current Price</span>
                        <span class="info-value" id="viz-current-price">--</span>
                    </div>
                    <div class="info-item" title="Call Wall - highest call gamma strike, acts as resistance">
                        <span class="info-label">Call Wall</span>
                        <span class="info-value call" id="viz-call-wall">--</span>
                    </div>
                    <div class="info-item" title="Put Wall - highest put gamma strike, acts as support">
                        <span class="info-label">Put Wall</span>
                        <span class="info-value put" id="viz-put-wall">--</span>
                    </div>
                    <div class="info-item" title="Max Pain - strike where option holders lose the most at expiry">
                        <span class="info-label">Max Pain</span>
                        <span class="info-value maxpain" id="viz-max-pain">--</span>
                    </div>
                    <div class="info-item" title="Total net Gamma Exposure across all strikes. Positive = stabilizing, Negative = volatile.">
                        <span class="info-label">Total GEX</span>
                        <span class="info-value" id="viz-total-gex">--</span>
                    </div>
                </div>
            </div>
        </div><!-- end tab-chart -->
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <span>Gamma Quantix - Options Flow & GEX Analysis</span>
            <span class="footer-divider">|</span>
            <span>Data: Tastytrade, Polygon</span>
            <span class="footer-divider">|</span>
            <span id="last-update">Last update: --</span>
        </div>
    </footer>

    <script src="js/app.js?v=20260222d"></script>
</body>
</html>
